var SlimeyNavigation=function(e){this.slimey=e,this.slimey.editor.addEventListener("actionPerformed",this.saveCurrentSlide,this),this.container=document.createElement("div"),this.container.className="slimeyNavigation",this.container.style.position="absolute",this.container.style.left="0px",this.container.style.top="59px",this.container.style.width="195px",this.container.style.cssFloat="left",this.slides=[],this.doms=[],this.divSlides=[],this.divSpacers=[];var t=unescapeSLIM(this.slimey.slimContent),n=t.split('<div class="slide">');this.slides[0]="";for(var r=1;r<n.length;r++)this.slides[r]=n[r].substr(0,n[r].lastIndexOf("</div>"));var i=this.createSpacerDiv(1);this.container.appendChild(i);for(r=1;r<this.slides.length;r++){var s=this.createSlideDiv(r);this.container.appendChild(s);var i=this.createSpacerDiv(r+1);this.container.appendChild(i)}this.currentSlide=0,this.slides.length>1&&this.getSlide(1)};SlimeyNavigation.prototype.getContainer=function(){return this.container},SlimeyNavigation.prototype.getSlide=function(e){var t;if(e==this.currentSlide)return;return this.currentSlide!=0&&(t=this.slimey.editor.getHTML(),this.divSlides[this.currentSlide].className="slidePreview",this.divSlides[this.currentSlide].parentNode.className="slideBorder",this.slides[this.currentSlide]=t,this.doms[this.currentSlide]=document.createElement("div"),this.slimey.editor.getDOM(this.doms[this.currentSlide]),this.divSlides[this.currentSlide].innerHTML=t),this.doms[e]?this.slimey.editor.setDOM(this.doms[e]):this.slimey.editor.setHTML(this.slides[e]),this.currentSlide=e,this.divSlides[this.currentSlide].className="slidePreviewSel",this.divSlides[this.currentSlide].parentNode.className="slideBorderSel",!1},SlimeyNavigation.prototype.saveCurrentSlide=function(){var e,t=this.slimey.editor.getHTML();this.slides[this.currentSlide]=t,e=this.divSlides[this.currentSlide],e&&(e.innerHTML=t)},SlimeyNavigation.prototype.insertNewSlide=function(e,t,n){var r,s,o,u;t||(t='<div style="font-size: 200%; font-weight: bold; font-family: sans-serif; position: absolute; left: 33%; top: 0%;">'+lang("some text")+"</div>"),r=this.divSpacers[e];for(i=this.divSlides.length-1;i>=e;i--)this.divSlides[i+1]=this.divSlides[i],this.divSlides[i+1].title=lang("Slide")+" "+(i+1),this.divSlides[i+1].slideNumber=i+1;for(i=this.divSpacers.length-1;i>=e;i--)this.divSpacers[i+1]=this.divSpacers[i],this.divSpacers[i+1].spacerNumber=i+1;for(i=this.slides.length-1;i>=e;i--)this.slides[i+1]=this.slides[i],this.doms[i+1]=this.doms[i];this.slides[e]=t,this.doms[e]=n,s=r.parentNode,o=this.createSpacerDiv(e),s.insertBefore(o,r),u=this.createSlideDiv(e),s.insertBefore(u,r),this.currentSlide>=e&&this.currentSlide++,this.getSlide(e)},SlimeyNavigation.prototype.deleteSlide=function(e){var t,n,r;if(e<1||e>this.slides.length){alert("No slide to delete!");return}t=this.divSpacers[e],n=this.divSlides[e],n.parentNode.parentNode.removeChild(n.parentNode),r=this.divSpacers[e],r.parentNode.removeChild(r);for(i=e;i<this.divSlides.length-1;i++)this.divSlides[i]=this.divSlides[i+1],this.divSlides[i].slideNumber=i,this.divSlides[i].title="Slide"+i;this.divSlides.length--;for(i=e;i<this.divSpacers.length-1;i++)this.divSpacers[i]=this.divSpacers[i+1],this.divSpacers[i].spacerNumber=i;this.divSpacers.length--;for(i=e;i<this.slides.length-1;i++)this.slides[i]=this.slides[i+1],this.doms[i]=this.doms[i+1];this.slides.length--,this.doms.length--,this.currentSlide=0,e<this.slides.length&&e>0?this.getSlide(e):this.slides.length>1?this.getSlide(this.slides.length-1):this.slimey.editor.setHTML('<h1 align="center" style="color: #999999"><i>Click "Add New" to add a slide.</i><h1>')},SlimeyNavigation.prototype.moveSlide=function(e,t){var n,r,s,o,u,a,f;if(e<1||e>this.slides.length||e==t){alert("No slide to move!");return}n=t>e?1:-1,r=this.divSlides[e],s=r.parentNode.parentNode,s.removeChild(r.parentNode),o=this.divSpacers[e],s.removeChild(o),e<t?s.insertBefore(o,this.divSlides[t].parentNode.nextSibling):s.insertBefore(o,this.divSlides[t].parentNode.previousSibling),s.insertBefore(r.parentNode,o.nextSibling),u=this.divSlides[e];for(i=e;i!=t;i+=n)this.divSlides[i]=this.divSlides[i+n],this.divSlides[i].slideNumber=i,this.divSlides[i].title=lang("Slide")+" "+i;this.divSlides[t]=u,u.slideNumber=t,u.title=lang("Slide")+" "+t,u=this.divSpacers[e];for(i=e;i!=t;i+=n)this.divSpacers[i]=this.divSpacers[i+n],this.divSpacers[i].spacerNumber=i;this.divSpacers[t]=u,u.spacerNumber=t,a=this.slides[e],f=this.doms[e];for(i=e;i!=t;i+=n)this.slides[i]=this.slides[i+n],this.doms[i]=this.doms[i+n];this.slides[t]=a,this.doms[t]=f,this.currentSlide=t},SlimeyNavigation.prototype.getSLIMContent=function(){var e,t=this.slimey.editor.getHTML();this.slides[this.currentSlide]=t,e="";for(i=1;i<this.slides.length;i++)e+='<div class="slide">'+this.slides[i]+"</div>";return e},SlimeyNavigation.prototype.createSlideDiv=function(e){var t,n=document.createElement("div");return n.slideNumber=e,n.slimey=this.slimey,n.className="slidePreview",n.title=lang("Slide")+" "+e,n.style.position="relative",n.innerHTML=this.slides[e],setEventHandler(n,"click",function(){var e=this.slideNumber,t=new SlimeyChangeSlideAction(this.slimey,e);this.slimey.editor.performAction(t)}),setEventHandler(n,"mouseover",function(){this.className="slidePreviewH",this.parentNode.className="slideBorderH"}),setEventHandler(n,"mouseout",function(){var e=this.slideNumber,t=e==this.slimey.navigation.currentSlide?"Sel":"";this.className="slidePreview"+t,this.parentNode.className="slideBorder"+t}),t=document.createElement("div"),t.className="slideBorder",t.appendChild(n),this.divSlides[e]=n,t},SlimeyNavigation.prototype.createSpacerDiv=function(e){var t=document.createElement("div");return t.spacerNumber=e,t.slimey=this.slimey,t.className="previewSpacer",t.title=lang("Click to insert a new slide"),setEventHandler(t,"click",function(){var e=new SlimeyInsertSlideAction(this.slimey,this.spacerNumber);this.slimey.editor.performAction(e),this.className="previewSpacer"}),setEventHandler(t,"mouseover",function(){this.className="previewSpacerH"}),setEventHandler(t,"mouseout",function(){this.className="previewSpacer"}),this.divSpacers[e]=t,t},SlimeyNavigation.prototype.addNewSlide=function(){var e=new SlimeyInsertSlideAction(this.slimey,this.currentSlide+1);this.slimey.editor.performAction(e)},SlimeyNavigation.prototype.deleteCurrentSlide=function(){var e;this.currentSlide>0&&(e=new SlimeyDeleteSlideAction(this.slimey,this.currentSlide),this.slimey.editor.performAction(e))},SlimeyNavigation.prototype.moveSlideDown=function(){var e;this.currentSlide<this.slides.length-1&&(e=new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide+1),this.slimey.editor.performAction(e))},SlimeyNavigation.prototype.moveSlideUp=function(){var e;this.currentSlide>1&&(e=new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide-1),this.slimey.editor.performAction(e))};