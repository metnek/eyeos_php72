function Z(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y=-1,n=-n,b=8-t,w=Al,E=R,S=E[i];if(n<-400)return[n,r,i];E[i]=a=E[r],E[r]=0,a&&(G[b][G[b].length]=[a,i]),a-t==1&&E[i+Ds[t>>3]]>15&&(E[i]+=4),a-t==6&&(r-i==2||i-r==2)&&(f=r-4+(r<i)*7,l=r+i>>1,E[f]=0,E[l]=t+2),c=Pz(t,u,n),h=c.length;if(h)if(e){c.sort(cp),e--,d=c[0],v=d[1],m=d[2],w=-Z(e,b,d[0],v,m,-o,-s,d[3])[0];for(y=1;y<h;y++){w>s&&(s=w),p=c[y],g=-Z(e,b,p[0],p[1],p[2],-s-1,-s,p[3])[0],g>s&&g<o&&(g=-Z(e,b,p[0],p[1],p[2],-o,-g,p[3])[0]);if(g>w){w=g,v=p[1],m=p[2],g>s&&(s=g);if(w>o)break}}}else{w=Al;while(--h&&o>w)c[h][0]>w&&(w=c[h][0])}else fy(0);return f&&(E[f]=t+2,E[l]=0),E[r]=a,E[i]=S,G[b].length--,[w,v,m]}function Sf(e,t,n,r,i){var s=R[r],o=R[r]=R[n];return R[n]=0,H(),t=Z(e,t,0,BE,BE,Al,Bt,i),R[n]=o,R[r]=s,t[0]}function mv(e,t,n){var r,i,s,o,u,a,f=R[t],l=R[e],c=l&7,h=M>>3,p=0,d=0,v=0;if(M==P){H(),r=Pz(M,K,0);for(;v<r.length;v++)d=d||e==r[v][1]&&t==r[v][2];if(!d)return 0;if(Sf(0,8-M,e,t,K)>400)return 0}Sf(0,M,e,t,K)>400&&(p=1),i=e%10,s=t-e,o=Ds[h],d=t%10,u=1+(N>>1),a="abcdefgh",Df((M?"     ":(u<10?" ":"")+u+".  ")+a.charAt(i-1)+((e-i)/10-1)+(f?"x":"-")+a.charAt(d-1)+((t-d)/10-1)+(p?"+":" ")),Sf(1,8-M,e,t,K)<-400&&fy(p);if((f&7)==6)return fy(1),0;Rh[N]=[R+"",KL+"",K],K=0,c==1&&(R[t+o]>15&&(R[e]+=4-n),s==2*o&&(R[t-1]&1||R[t+1]&1)&&(K=e+o),!f&&s%10&&Sh(t,t-o));if(e==21+h*70||e==28+h*70)KL[h]&=(i<5)+1;if(t==21+h*70||t==28+h*70)KL[!h]&=(i<5)+1;return c==6&&(s*s==4&&Sh(e-4+(e<t)*7,e+s/2),KL[h]=0),Sh(e,t),H(),N++,M=8-M,1}function fy(e){Df(e?"checkmate!":"stalemate!"),J=e++}function H(){var e,t=99;s0=N<32?4-(N>>3):N>64,G[0]=[],G[8]=[],kY=[],pY=[[],[]];for(;t>20;t--)a=R[t],a&7&&(G[a&8][G[a&8].length]=[a,t]),Y[t]=bY[t]*s0,kY[t]=N>40||(10-2*bY[t])*s0,e=pY[1][119-t]=pY[0][t]=PY[t],N<7&&t>40&&(pY[0][t]=pY[1][119-t]=e+Math.random()*Y[t]|1,Y[24]=Y[94]=29)}function Pz(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m=-1,g=e>>3,y=e^8,b=Ds[g],w=[],E=pY[g],S=KL[g],x=G[e],T=x.length,N=R,C=j;for(p=0;p<T;p++){r=x[p][1],u=N[r];if(x[p][0]==u){u&=7;if(u>1){d=u==6,h=d?kY:Y,c=n-h[r],f=MV[u];if(u==3||d){for(a=0;a<8;){i=r+f[a++],o=N[i];if(!o||(o&24)==y)w[++m]=[c+C[o]+h[i],r,i]}d&&S&&(S&1&&!(N[r-1]+N[r-2]+N[r-3])&&CH(r-2,y,b,-1)&&(w[++m]=[c+11,r,r-2]),S&2&&!(N[r+1]+N[r+2])&&CH(r,y,b,1)&&(w[++m]=[c+12,r,r+2]))}else{v=f.length;for(a=0;a<v;){o=0,l=f[a++],i=r;while(!o){i+=l,o=N[i];if(!o||(o&24)==y)w[++m]=[c+C[o]+h[i],r,i]}}}}else{c=n-E[r],i=r+b,N[i]||(w[++m]=[c+E[i],r,i],!E[r]&&!N[i+b]&&(w[++m]=[c+E[i+b],r,i+b,i])),t&&(t==i+1||t==i-1)&&(w[++m]=[c+E[i],r,t]);for(s=i-1;s<i+2;s+=2)o=N[s]+e,o&7&&o&8&&(w[++m]=[c+C[o]+E[s],r,s])}}}return w}function CH(e,t,n,r){var i,s,o,u=e+3,a=n+2,f=MV[3],l=R;for(;e<u;e++){for(o=n-2;++o<a;){s=l[e+o];if(!(!s||(s&8)!=t||(s&8)!=1&&(s&7)!=6))return 0;s=0,i=e;while(!s){i+=o,s=l[i];if(s==t+2+(o!=n)*2||s==t+5)return 0}}for(z=0;z<8;)if(l[e+f[z++]]-t==3)return 0}s=0,e-=3;while(!s){e-=r,s=l[e];if(s==t+2||s==t+5)return 0}return 1}function B(e){var t,n=R[e],r="PI";if(J)return;if(q==e&&I){O(r,0),O(q,I,1),I=0;return}if(n&&M==(n&8)){I&&O(q,I,1),I=n,q=e,O(q,0,1),O(r,n),E&&dr(),d.onmousemove=dr;return}I&&mv(q,e,d.FF.h.selectedIndex,y)&&(O(r,0),d.onmousemove=null,A&&(Ic.top=Ic.left="0px"),I=0,J||(t=Z(d.FF.i.selectedIndex+1,M,0,BE,BE,Al,Bt,K),mv(t[1],t[2],0)))}function Sh(e,t){var n=R[e];R[t]=n,R[e]=0,O(e,0,1),O(t,n,1)}function Df(e){d.FF.b.value+="\n "+e}function Rf(e){var t;P=e;for(t=0;t<BE;t++)R[t]<16&&O(t,R[t],1);P!=M&&(Tt=Z(d.FF.i.selectedIndex+1,M,0,BE,BE,Al,Bt,K),mv(Tt[1],Tt[2],0))}function Gb(){var b;if(!N)return;N-=2,b=Rh[N],R=eval("["+b[0]+"]"),KL=eval("["+b[1]+"]"),Df(" --undo--"),K=b[2],M=N%2,Rf(M),H()}function dr(e){e=e||event,Ic.left=e.clientX+1+"px",Ic.top=e.clientY-4+"px"}function O(e,t,n){(A||e!="PI")&&n&&(e="i"+(P?119-e:e)),d.images[e].src="index.php?theme="+USERTHEME+"&extern=$imagesDir/"+t+".png"}var windowd=document.getElementById("$myPid_eyeChess_Window_Content");M=I=P=N=q=K=J=Btime=0,Bt=1999,Al=-Bt,Ds=[10,-10],BE=120,Rh=[],G=[],R=[],KL=[3,3],j=[0,1,5,3,3,9,63,0],MV=[0,0,[1,10],[21,19,12,8],[11,9],[1,10,11,9],[1,10,11,9],0];for(z=0;z<8;){j[z+8]=j[z]<<=4,m=MV[z++];if(m){s=m.length;for(x=0;x<s;)m[s+x]=-m[x++]}}x="g00000000g",y="gggggggggg",b=y+y+"g23456432gg11111111g"+x+x+x+x+"g99999999ggABCDECBAg"+y+y,w=x+x+x+"000111100000123321000123553210",a="000012346900",Y=[],PY=[],bY=[];for(y=0;y<12;y++)for(x=0;x<10;x++)z=y*10+x,PY[z]=parseInt(a.charAt(y)),bY[z]=parseInt(w.charAt(z<60?z:119-z),35)&7,R[z]=parseInt(b.charAt(z),35);R[BE]=0,d=document,A=E=d.all,E||(event=0),DM=d.getElementsByTagName||null;if(DM||E)windowd.innerHTML+='<img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" id="PI" name="PI" width="47" height="48" />',A=E||d.getElementsByTagName("img"),Ic=A.PI.style;cp=function(e,t){return t[0]-e[0]},h='<table cellpadding="4" class="eyeChess_t">';for(y=90;y>10;y-=10){h+="<tr>";for(x=0;x<10;x++)z=y+x,x&&x<9&&(h+='<td class="'+(x+y/10&1?"eyeChess_b":"eyeChess_w")+'"><span onclick="B(P?119-'+z+":"+z+');" style="cursor: pointer;"><img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" width="0" height="48" border="0"><img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" width="47" height="48" name="i'+z+'" border="0" /><img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" width="0" height="48" border="0" /></span></td>\n');h+="</tr>\n"}h+="</table>",windowd.innerHTML+=h,Rf(0),windowd.innerHTML+='<form name="FF"><div style="text-align: center;"><table class="eyeChess_Table" border="0"><tr><td></td><td><textarea name="b" style="margin-top:5px;margin-left:5px;height:457px;" cols="12" rows="24" class="eyeTextarea">$lang:Movements:</textarea></td></tr></table><input type="button" class="eyeButtonClass" value="$lang:Undo" class="eyeButton" style="margin-top: 6px; position:absolute; top:475px; left:400px;" onclick="Gb();" /><div class="eyeChess_Text" style="margin-top: 15px;">$lang:Next pawn becomes: <select name="h" class="eyeSelect"><option selected="selected">$lang:Queen</option><option>$lang:Bishop</option><option>$lang:Knight</option><option>$lang:Rook</option></select> &nbsp; $lang:Computer level: <select class="eyeSelect" name="i"><option>$lang:Easy</option><option selected="selected">$lang:Middling</option><option>$lang:Slow</option></select></div></div></form>',H();