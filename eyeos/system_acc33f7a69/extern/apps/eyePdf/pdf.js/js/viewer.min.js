"use strict";function updateViewarea(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p=PDFView.getVisiblePages();for(e=0;e<p.length;e++)t=p[e],renderingQueue.enqueueDraw(PDFView.pages[t.id-1]);if(!p.length)return;updateViewarea.inProgress=!0,n=PDFView.page,r=p[0],PDFView.page=r.id,updateViewarea.inProgress=!1,i=PDFView.currentScale,s=PDFView.currentScaleValue,o=s==i?i*100:s,u=52,a=r.id,f="#page="+a,f+="&zoom="+o,l=PDFView.pages[a-1],c=l.getPagePoint(window.pageXOffset,window.pageYOffset-r.y-u),f+=","+Math.round(c.x)+","+Math.round(c.y),h=PDFView.store,h.set("exists",!0),h.set("page",a),h.set("zoom",o),h.set("scrollLeft",Math.round(c.x)),h.set("scrollTop",Math.round(c.y))}function updateThumbViewArea(){var e=50;thumbnailTimer&&clearTimeout(thumbnailTimer),thumbnailTimer=setTimeout(function(){var e,t,n=PDFView.getVisibleThumbs();for(e=0;e<n.length;e++)t=n[e],renderingQueue.enqueueDraw(PDFView.thumbnails[t.id-1])},e)}function selectScaleOption(e){var t,n,r=document.getElementById("scaleSelect").options,i=!1;for(t=0;t<r.length;t++){n=r[t];if(n.value!=e){n.selected=!1;continue}n.selected=!0,i=!0}return i}var thumbnailTimer,kDefaultScale="auto",kDefaultScaleDelta=1.1,kCacheSize=20,kCssUnits=96/72,kScrollbarPadding=40,kMinScale=.25,kMaxScale=4,kImageDirectory="index.php?extern=apps/eyePdf/pdf.js/images/",kSettingsMemory=20,Cache=function(t){var n=[];this.push=function(r){var i=n.indexOf(r);i>=0&&n.splice(i),n.push(r),n.length>t&&n.shift().update()}},RenderingQueue=function(){function t(){this.items=[]}return t.prototype={enqueueDraw:function(t){if("rendering"in t)return;t.rendering=!0,this.items.push(t);if(this.items.length>1)return;t.draw(this.continueExecution.bind(this))},continueExecution:function(){var t=this.items.shift();delete t.rendering;if(this.items.length==0)return;t=this.items[0],t.draw(this.continueExecution.bind(this))}},t}(),Settings=function(){function o(e){var s=null,o;if(i)return!1;if(r)s=Application.prefs.getValue(n+".database","{}");else{if(!t)return!1;s=localStorage.getItem("database")||"{}"}s=JSON.parse(s),"files"in s||(s.files=[]),s.files.length>=kSettingsMemory&&s.files.shift();for(var u=0,a=s.files.length;u<a;u++){var f=s.files[u];if(f.fingerprint==e){o=u;break}}typeof o!="number"&&(o=s.files.push({fingerprint:e})-1),this.file=s.files[o],this.database=s,r?Application.prefs.setValue(n+".database",JSON.stringify(s)):t&&localStorage.setItem("database",JSON.stringify(s))}var t=function(){try{localStorage}catch(t){return!1}return!0}(),n="extensions.uriloader@pdf.js",r=location.protocol=="chrome:"&&!t,i=!1;if(r){var s=Components.classes["@mozilla.org/privatebrowsing;1"].getService(Components.interfaces.nsIPrivateBrowsingService);i=s.privateBrowsingEnabled}return o.prototype={set:function(s,o){if(i)return!1;var u=this.file;u[s]=o,r?Application.prefs.setValue(n+".database",JSON.stringify(this.database)):t&&localStorage.setItem("database",JSON.stringify(this.database))},get:function(t,n){return i?n:this.file[t]||n}},o}(),cache=new Cache(kCacheSize),renderingQueue=new RenderingQueue,currentPageNumber=1,PDFView={pages:[],thumbnails:[],currentScale:0,currentScaleValue:null,initialBookmark:document.location.hash.substring(1),setScale:function(t,n){if(t==this.currentScale)return;var r=this.pages;for(var i=0;i<r.length;i++)r[i].update(t*kCssUnits);this.currentScale!=t&&this.pages[this.page-1].scrollIntoView(),this.currentScale=t;var s=document.createEvent("UIEvents");s.initUIEvent("scalechange",!1,!1,window,0),s.scale=t,s.resetAutoSettings=n,window.dispatchEvent(s)},parseScale:function(t,n){if("custom"==t)return;var r=parseFloat(t);this.currentScaleValue=t;if(r){this.setScale(r,!0);return}var i=this.pages[this.page-1],s=(window.innerWidth-kScrollbarPadding)/i.width/kCssUnits,o=(window.innerHeight-kScrollbarPadding)/i.height/kCssUnits;"page-width"==t&&this.setScale(s,n),"page-height"==t&&this.setScale(o,n),"page-fit"==t&&this.setScale(Math.min(s,o),n),"auto"==t&&this.setScale(Math.min(1,s),n),selectScaleOption(t)},zoomIn:function(){var t=Math.min(kMaxScale,this.currentScale*kDefaultScaleDelta);this.setScale(t,!0)},zoomOut:function(){var t=Math.max(kMinScale,this.currentScale/kDefaultScaleDelta);this.setScale(t,!0)},set page(e){var t=this.pages,n=document.getElementById("pageNumber");if(0>=e||e>t.length){var r=document.createEvent("UIEvents");r.initUIEvent("pagechange",!1,!1,window,0),r.pageNumber=this.page,window.dispatchEvent(r);return}currentPageNumber=e;var r=document.createEvent("UIEvents");r.initUIEvent("pagechange",!1,!1,window,0),r.pageNumber=e,window.dispatchEvent(r);if(updateViewarea.inProgress)return;if(this.loading&&e==1)return;t[e-1].scrollIntoView()},get page(){return currentPageNumber},open:function(t,n){document.title=this.url=t;var r=this;PDFJS.getPdf({url:t,progress:function(t){t.lengthComputable&&r.progress(t.loaded/t.total)},error:function(t){var n=document.getElementById("loading");n.innerHTML="Error";var i={message:"Unexpected server response of "+t.target.status+"."};r.error("An error occurred while loading the PDF.",i)}},function(t){r.loading=!0,r.load(t,n),r.loading=!1})},download:function(){window.open(this.url+"#pdfjs.action=download","_blank")},navigateTo:function(t){typeof t=="string"&&(t=this.destinations[t]);if(!(t instanceof Array))return;var n=t[0],r=n instanceof Object?this.pagesRefMap[n.num+" "+n.gen+" R"]:n+1;if(r){this.page=r;var i=this.pages[r-1];i.scrollIntoView(t)}},getDestinationHash:function(t){if(typeof t=="string")return"#"+escape(t);if(t instanceof Array){var n=t[0],r=n instanceof Object?this.pagesRefMap[n.num+" "+n.gen+" R"]:n+1;if(r){var i="#page="+r,s=t[1];if("name"in s&&s.name=="XYZ"){var o=t[4]||this.currentScale;i+="&zoom="+o*100;if(t[2]||t[3])i+=","+(t[2]||0)+","+(t[3]||0)}return i}}return""},error:function(t,n){var r=document.getElementById("errorWrapper");r.removeAttribute("hidden");var i=document.getElementById("errorMessage");i.innerHTML=t;var s=document.getElementById("errorClose");s.onclick=function(){r.setAttribute("hidden","true")};var o=document.getElementById("errorMoreInfo"),u=document.getElementById("errorShowMore"),a=document.getElementById("errorShowLess");u.onclick=function(){o.removeAttribute("hidden"),u.setAttribute("hidden","true"),a.removeAttribute("hidden")},a.onclick=function(){o.setAttribute("hidden","true"),u.removeAttribute("hidden"),a.setAttribute("hidden","true")},u.removeAttribute("hidden"),a.setAttribute("hidden","true"),o.innerHTML="PDF.JS Build: "+PDFJS.build+"\n",n&&(o.innerHTML+="Message: "+n.message,n.stack&&(o.innerHTML+="\nStack: "+n.stack))},progress:function(t){var n=Math.round(t*100),r=document.getElementById("loading");r.innerHTML="Loading... "+n+"%"},load:function(t,n){function r(e,t){e.onAfterDraw=function(){t.setImage(e.canvas)}}var i=document.getElementById("errorWrapper");i.setAttribute("hidden","true");var s=document.getElementById("loading");s.setAttribute("hidden","true");var o=document.getElementById("sidebarView");o.parentNode.scrollTop=0;while(o.hasChildNodes())o.removeChild(o.lastChild);"_loadingInterval"in o&&clearInterval(o._loadingInterval);var u=document.getElementById("viewer");while(u.hasChildNodes())u.removeChild(u.lastChild);var a;try{a=new PDFJS.PDFDoc(t)}catch(f){this.error("An error occurred while reading the PDF.",f)}var l=a.numPages,c=a.fingerprint,h=null;document.getElementById("numPages").innerHTML=l,document.getElementById("pageNumber").max=l,PDFView.documentFingerprint=c;var p=PDFView.store=new Settings(c);if(p.get("exists",!1)){var d=p.get("page","1"),v=p.get("zoom",PDFView.currentScale),m=p.get("scrollLeft","0"),g=p.get("scrollTop","0");h="page="+d+"&zoom="+v+","+m+","+g}var y=this.pages=[],b={},w=this.thumbnails=[];for(var E=1;E<=l;E++){var d=a.getPage(E),S=new PageView(u,d,E,d.width,d.height,d.stats,this.navigateTo.bind(this)),x=new ThumbnailView(o,d,E,d.width/d.height);r(S,x),y.push(S),w.push(x);var T=d.ref;b[T.num+" "+T.gen+" R"]=E}this.pagesRefMap=b,this.destinations=a.catalog.destinations;if(a.catalog.documentOutline){this.outline=new DocumentOutlineView(a.catalog.documentOutline);var N=document.getElementById("outlineSwitch");N.removeAttribute("disabled"),this.switchSidebarView("outline")}this.initialBookmark?(this.setHash(this.initialBookmark),this.initialBookmark=null):h?this.setHash(h):(this.setScale(n||kDefaultScale,!0),this.page=1)},setHash:function(t){if(!t)return;if(t.indexOf("=")<0)/^\d+$/.test(t)?this.page=t:PDFView.navigateTo(unescape(t));else{var n=t.split("&"),r={};for(var i=0;i<n.length;++i){var s=n[i].split("=");r[s[0]]=s[1]}if("nameddest"in r){PDFView.navigateTo(r.nameddest);return}if("page"in r){var o=r.page|0||1;this.page=o;if("zoom"in r){var u=r.zoom.split(","),a=u[0],f=parseFloat(a);f&&(a=f/100);var l=[null,{name:"XYZ"},u[1]|0,u[2]|0,a],c=this.pages[o-1];c.scrollIntoView(l)}else this.page=r.page;return}}},switchSidebarView:function(t){var n=document.getElementById("sidebarScrollView"),r=document.getElementById("outlineScrollView"),i=document.getElementById("thumbsSwitch"),s=document.getElementById("outlineSwitch");switch(t){case"thumbs":n.removeAttribute("hidden"),r.setAttribute("hidden","true"),i.setAttribute("data-selected",!0),s.removeAttribute("data-selected"),updateThumbViewArea();break;case"outline":n.setAttribute("hidden","true"),r.removeAttribute("hidden"),i.removeAttribute("data-selected"),s.setAttribute("data-selected",!0)}},getVisiblePages:function(){var t=this.pages,n=10,r=[],i=n,s=window.pageYOffset;for(var o=1;o<=t.length;++o){var u=t[o-1],a=u.height*u.scale+n;if(i+a>s)break;i+=a}var f=window.pageYOffset+window.innerHeight;for(;o<=t.length&&i<f;++o){var l=t[o-1];r.push({id:l.id,y:i,view:l}),i+=l.height*l.scale+n}return r},getVisibleThumbs:function(){var t=this.thumbnails,n=5,r=[],i=document.getElementById("sidebarScrollView"),s=n,o=i.scrollTop;for(var u=1;u<=t.length;++u){var a=t[u-1],f=a.height*a.scaleY+n;if(s+f>o)break;s+=f}var l=o+i.clientHeight;for(;u<=t.length&&s<l;++u){var c=t[u-1];r.push({id:c.id,y:s,view:c}),s+=c.height*c.scaleY+n}return r}},PageView=function(t,n,r,i,s,o,u){function c(e,t){function n(e,t){e.href=PDFView.getDestinationHash(t),e.onclick=function(){return t&&PDFView.navigateTo(t),!1}}function r(e,n){var r=document.createElement(e);return r.style.left=Math.floor(n.x-a.x)*t+"px",r.style.top=Math.floor(n.y-a.y)*t+"px",r.style.width=Math.ceil(n.width*t)+"px",r.style.height=Math.ceil(n.height*t)+"px",r}function i(e,n){var i=document.createElement("section");i.className="annotComment";var s=r("img",n);s.src=kImageDirectory+e.toLowerCase()+".svg";var o=document.createElement("div");o.setAttribute("hidden",!0);var u=document.createElement("h1"),f=document.createElement("p"),l=Math.floor(n.x-a.x+n.width);return o.style.left=l*t+"px",o.style.top=Math.floor(n.y-a.y)*t+"px",u.textContent=n.title,n.content?(f.innerHTML=n.content.replace("\n","<br />"),s.addEventListener("mouseover",function(){this.nextSibling.removeAttribute("hidden")},!1),s.addEventListener("mouseout",function(){this.nextSibling.setAttribute("hidden",!0)},!1)):o.setAttribute("hidden",!0),o.appendChild(u),o.appendChild(f),i.appendChild(s),i.appendChild(o),i}var s=e.getAnnotations();for(var o=0;o<s.length;o++){var u=s[o];switch(u.type){case"Link":var f=r("a",u);f.href=u.url||"",u.url||n(f,"dest"in u?u.dest:null),l.appendChild(f);break;case"Text":var c=i(u.name,u);c&&l.appendChild(c)}}}this.id=r,this.content=n;var a=this.content.view;this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height;var f=document.createElement("a");f.name=""+this.id;var l=document.createElement("div");l.id="pageContainer"+this.id,l.className="page",t.appendChild(f),t.appendChild(l),this.update=function(t){this.scale=t||this.scale,l.style.width=this.width*this.scale+"px",l.style.height=this.height*this.scale+"px";while(l.hasChildNodes())l.removeChild(l.lastChild);l.removeAttribute("data-loaded"),delete this.canvas},this.getPagePoint=function(t,n){var r=PDFView.currentScale;return this.content.rotatePoint(t/r,n/r)},this.scrollIntoView=function(t){if(!t){l.scrollIntoView(!0);return}var n=0,r=0,i=0,s=0,o,u,a=0;switch(t[1].name){case"XYZ":n=t[2],r=t[3],a=t[4];break;case"Fit":case"FitB":a="page-fit";break;case"FitH":case"FitBH":r=t[2],a="page-width";break;case"FitV":case"FitBV":n=t[2],a="page-height";break;case"FitR":n=t[2],r=t[3],i=t[4]-n,s=t[5]-r,o=(window.innerWidth-kScrollbarPadding)/i/kCssUnits,u=(window.innerHeight-kScrollbarPadding)/s/kCssUnits,a=Math.min(o,u);break;default:return}var f=[this.content.rotatePoint(n,r),this.content.rotatePoint(n+i,r+s)];a&&a!==PDFView.currentScale&&PDFView.parseScale(a,!0),setTimeout(function(){var t=PDFView.currentScale,n=Math.min(f[0].x,f[1].x),r=Math.min(f[0].y,f[1].y),i=Math.abs(f[0].x-f[1].x),s=Math.abs(f[0].y-f[1].y),o=document.createElement("div");o.style.position="absolute",o.style.left=Math.floor(n*t)+"px",o.style.top=Math.floor(r*t)+"px",o.style.width=Math.ceil(i*t)+"px",o.style.height=Math.ceil(s*t)+"px",l.appendChild(o),o.scrollIntoView(!0),l.removeChild(o)},0)},this.draw=function(t){if(l.hasChildNodes()){this.updateStats(),t();return}var n=document.createElement("canvas");n.id="page"+this.id,n.mozOpaque=!0,l.appendChild(n),this.canvas=n;var r=document.createElement("div");r.className="textLayer",l.appendChild(r);var u=this.scale;n.width=i*u,n.height=s*u;var a=n.getContext("2d");a.save(),a.fillStyle="rgb(255, 255, 255)",a.fillRect(0,0,n.width,n.height),a.restore(),a.translate(-this.x*u,-this.y*u),o.begin=Date.now(),this.content.startRendering(a,function(n){n&&PDFView.error("An error occurred while rendering the page.",n),this.updateStats(),this.onAfterDraw&&this.onAfterDraw(),cache.push(this),t()}.bind(this),r),c(this.content,this.scale),l.setAttribute("data-loaded",!0)},this.updateStats=function(){var t=o.compile,n=o.fonts,r=o.render,i="Time to compile/fonts/render: "+(t-o.begin)+"/"+(n-t)+"/"+(r-n)+" ms";document.getElementById("info").innerHTML=i}},ThumbnailView=function(t,n,r,i){function p(){var e=document.createElement("canvas");e.id="thumbnail"+r,e.mozOpaque=!0,e.width=a,e.height=f,h.setAttribute("data-loaded",!0),h.appendChild(e);var t=e.getContext("2d");t.save(),t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,e.width,e.height),t.restore();var i=n.view;return t.translate(-i.x*l,-i.y*c),h.style.width=i.width*l+"px",h.style.height=i.height*c+"px",h.style.lineHeight=i.height*c+"px",t}var s=document.createElement("a");s.href="#"+r,s.onclick=function(){return PDFView.page=r,!1};var o=n.view;this.width=o.width,this.height=o.height,this.id=r;var u=134,a=i<1?u*i:u,f=i>1?u/i:u,l=this.scaleX=a/this.width,c=this.scaleY=f/this.height,h=document.createElement("div");h.id="thumbnailContainer"+r,h.className="thumbnail",s.appendChild(h),t.appendChild(s),this.hasImage=!1,this.draw=function(t){if(this.hasImage){t();return}var r=p();n.startRendering(r,function(){t()}),this.hasImage=!0},this.setImage=function(t){if(this.hasImage)return;var n=p();n.drawImage(t,0,0,t.width,t.height,0,0,n.canvas.width,n.canvas.height),this.hasImage=!0}},DocumentOutlineView=function(t){function r(e,t){e.href=PDFView.getDestinationHash(t.dest),e.onclick=function(n){return PDFView.navigateTo(t.dest),!1}}var n=document.getElementById("outlineView"),i=[{parent:n,items:t}];while(i.length>0){var s=i.shift(),o,u=s.items.length;for(o=0;o<u;o++){var a=s.items[o],f=document.createElement("div");f.className="outlineItem";var l=document.createElement("a");r(l,a),l.textContent=a.title,f.appendChild(l);if(a.items.length>0){var c=document.createElement("div");c.className="outlineItems",f.appendChild(c),i.push({parent:c,items:a.items})}s.parent.appendChild(f)}}};window.addEventListener("load",function(){var e,t,n,r,i=document.location.search.substring(1).split("&");for(e=0;e<i.length;e++)t=i[e].split("="),i[unescape(t[0])]=unescape(t[1]);n="scale"in i?i.scale:kDefaultScale,PDFView.open(i.file||kDefaultURL,parseFloat(n)),"disableWorker"in i&&(PDFJS.disableWorker=i.disableWorker==="true"?!0:!1),r=document.getElementById("sidebarScrollView"),r.addEventListener("scroll",updateThumbViewArea,!0)},!0),window.addEventListener("unload",function(){window.scrollTo(0,0)},!0),window.addEventListener("scroll",function(){updateViewarea()},!0),window.addEventListener("transitionend",updateThumbViewArea,!0),window.addEventListener("webkitTransitionEnd",updateThumbViewArea,!0),window.addEventListener("resize",function(){(document.getElementById("pageWidthOption").selected||document.getElementById("pageFitOption").selected||document.getElementById("pageAutoOption").selected)&&PDFView.parseScale(document.getElementById("scaleSelect").value),updateViewarea()}),window.addEventListener("hashchange",function(){PDFView.setHash(document.location.hash.substring(1))}),window.addEventListener("change",function(e){var t,n,r=e.target.files;if(!r||r.length==0)return;t=new FileReader,t.onload=function(e){var t,n=e.target.result,r=new ArrayBuffer(n.length),i=new Uint8Array(r);for(t=0;t<n.length;t++)i[t]=n.charCodeAt(t);PDFView.load(i)},n=r[0],t.readAsBinaryString(n),document.title=n.name,document.getElementById("download").setAttribute("hidden","true")},!0),window.addEventListener("scalechange",function(e){var t,n=document.getElementById("customScaleOption");n.selected=!1;if(!e.resetAutoSettings&&(document.getElementById("pageWidthOption").selected||document.getElementById("pageFitOption").selected)){updateViewarea();return}t=selectScaleOption(""+e.scale),t||(n.textContent=Math.round(e.scale*1e4)/100+"%",n.selected=!0),updateViewarea()},!0),window.addEventListener("pagechange",function(e){var t=e.pageNumber;document.getElementById("pageNumber").value!=t&&(document.getElementById("pageNumber").value=t),document.getElementById("previous").disabled=t<=1,document.getElementById("next").disabled=t>=PDFView.pages.length},!0),window.addEventListener("keydown",function(e){var t,n,r;if(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;t=document.activeElement;if(t&&t.tagName=="INPUT")return;n=document.getElementById("controls");while(t){if(t===n)return;t=t.parentNode}r=!1;switch(e.keyCode){case 61:case 107:case 187:PDFView.zoomIn(),r=!0;break;case 109:case 189:PDFView.zoomOut(),r=!0;break;case 48:PDFView.setScale(kDefaultScale,!0),r=!0;break;case 37:case 75:case 80:PDFView.page--,r=!0;break;case 39:case 74:case 78:PDFView.page++,r=!0}r&&e.preventDefault()});