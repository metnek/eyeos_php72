function calculePart(e,t){var n=Math.floor(e*100/t);if(n<=25)return 1;if(n<=50)return 2;if(n<=75)return 3;if(n<=100)return 4}function calendar_GetPid(e){var t;e=e.parentNode;for(t=0;t<5;t+=1){if(e.pid)return e.pid;e=e.parentNode}}function calendar_updateCurrentHour(e){weekPlanner_instances[e]&&weekPlanner_instances[e].base.updateCurrentHour(e)}function resizeDays(){var e,t,n,r,i=parseInt(this.numDays,10)+.1;this.rowWidth=(xWidth(this.base.daysBase)-i)/this.numDays,e="";for(r=this.dayFrom;r<=this.numDays-1;r+=1)e=xGetElementById(this.pid+"_dayTodo_"+r),e.style.width=this.rowWidth+"px",e=xGetElementById(this.pid+"_dayName_"+r),e.style.width=this.rowWidth+"px",e=xGetElementById(this.pid+"_day_"+r),e.style.width=this.rowWidth+"px";t=xGetElementById(this.pid+"_fatherDays"),n=t.parentNode.style.height,t.style.height=n}function mouseDown(e){var t,n,r=new xEvent(e);r.target.noPrevent||xPreventDefault(e);if(!r||!r.target||!r.target.id)return!1;if(!r.target.pid){t=calendar_GetPid(r.target);if(!t)return!1}else t=r.target.pid;n=weekPlanner_instances[t],n.events.mouseDown(r)}function mouseOver(e){var t,n,r;xPreventDefault(e),t=new xEvent(e);if(!t||!t.target||!t.target.id)return!1;if(!t.target.pid){n=calendar_GetPid(t.target);if(!n)return!1}else n=t.target.pid;r=weekPlanner_instances[n],r.events.mouseOver(t)}function mouseUp(e){var t,n,r;xPreventDefault(e),t=new xEvent(e);if(!t||!t.target||!t.target.id)return!1;if(t.target.id!=="eyeApps"){if(!t.target.pid){n=calendar_GetPid(t.target);if(!n)return!1}else n=t.target.pid;r=weekPlanner_instances[n],r.events.mouseUp(t)}}function mouseClick(e){var t,n,r=new xEvent(e);if(!r||!r.target||!r.target.id)return!1;r.target.noPrevent||xPreventDefault(e);if(!r.target.pid){t=calendar_GetPid(r.target);if(!t)return!1}else t=r.target.pid;n=weekPlanner_instances[t],n.events.mouseClick(r)}function keyPress(e){var t,n,r=new xEvent(e);if(!r.target.pid){t=calendar_GetPid(r.target);if(!t)return!1}else t=r.target.pid;n=weekPlanner_instances[t],n.events.keyPress(r)}function weekPlanner_base(e){this.father=e,this.timeOut=null,this.totalParts=0,this.changeDate=function(e,t){var n,r,i;for(r=0;r<=this.dayNames.childNodes.length;r+=1)n=t+r,i=this.dayNames.childNodes[r].firstChild,i.data=e[n]},this.draw_dayNames=function(){var e,t,n;for(t=this.father.dayFrom;t<=this.father.dayEven-1;t+=1)e=document.createElement("div"),e.setAttribute("id",this.father.pid+"_dayName_"+t),e.style.position="relative",e.style.cssFloat="left",e.style.styleFloat="left",IEversion===6?e.style.width=this.father.rowWidth+1+"px":e.style.width=this.father.rowWidth+"px",e.style.height="100%",e.style.textAlign="center",e.style.color="#145689",e.style.lineHeight="200%",t!==this.father.dayFrom&&(!IEversion||IEversion>6)?e.style.borderLeft="1px transparent solid":t!==this.father.dayFrom&&(e.style.borderLeft="1px transparent"),n=document.createTextNode(this.father.weekDays[t]),e.appendChild(n),this.dayNames.appendChild(e)},this.draw_todos=function(){var e,t;for(e=this.father.dayFrom;e<=this.father.dayEven-1;e+=1)t=document.createElement("div"),t.setAttribute("id",this.father.pid+"_dayTodo_"+e),t.style.position="relative",t.style.cssFloat="left",t.style.styleFloat="left",t.style.width=this.father.rowWidth+"px",t.style.height="100%",t.style.textAlign="center",t.style.color="#145689",e!==this.father.dayFrom&&(t.style.borderLeft="1px #C1C1C1 solid"),this.dayTodo.appendChild(t)},this.draw_bodyDays=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p=function(){for(h=0;h<this.notes.length;h+=1)w=this.notes[h].startPartObj.numOfLevels(),this.notes[h].level===0||w===1?(this.notes[h].style.width="50%",this.notes[h].style.left="0px",this.notes[h].level=0):(e=90/w,u=e*this.notes[h].level,c=90-u,this.notes[h].style.width=c+"%",this.notes[h].style.left=u+"%",this.notes[h].style.zIndex=10+this.notes[h].level)},d=function(e){var t,n,r,i,s,o=e.cid;this.notes[o]=e,n=e.startPartObj.addNote(e),e.level=n,t=e.startPart,t+=e.parts,t-=1,i=e.fromParts,r=e.startPart+1;for(s=r;s<i;s+=1)xGetElementById(e.day+"_part_"+s).addNoteToLevel(e,n)},v=function(e){var t,n,r,i,s=e.cid;delete this.notes[s],this.notes.sort(),this.notes.pop(),e.startPartObj.delNote(e),t=e.startPart,t+=e.parts,t-=1,n=e.fromParts,r=e.startPart+1;for(i=r;i<n;i+=1)xGetElementById(e.day+"_part_"+i).delNoteToLevel(e,e.level)},m=function(e,t){this.notesLevel[t]?(this.notesLevel[t].moveLevel(t),this.notesLevel[t]=e):this.notesLevel[t]=e},g=function(e,t){this.notesLevel[t]&&delete this.notesLevel[t]},y=function(e){var t,n;for(n=0;n<=this.notesLevel.length;n+=1)if(typeof this.notesLevel[n]=="undefined")return this.notesLevel[n]=e,n;return t=this.notesLevel.push(e),t-=1,t},b=function(e){var t;for(t=0;t<=this.notesLevel.length;t+=1)this.notesLevel[t].cid===e.cid&&(delete this.notesLevel[t],this.notesLevel.sort(),this.notesLevel.pop())},w=function(){var e,t=0;for(e=0;e<=this.notesLevel.length;e+=1)this.notesLevel[e]&&(t+=1);return t},E=document.createElement("div"),S=this.father.dayFrom;E.setAttribute("id",this.father.pid+"_day_"+S),E.className="eyeCalendar_day",E.style.width=this.father.rowWidth+"px",E.notes=[],E.orderNotes=p,E.addNote=d,E.delNote=v,a=0;for(n=this.father.hourFrom;n<=this.father.hourEven;n+=1){i=document.createElement("div"),i.setAttribute("id",this.father.pid+"_hour_"+S+"_"+n),i.className="eyeCalendar_hour",i.style.height=this.father.rowHeight+"px",i.pid=this.father.pid,o=a*4,t=o+4;for(o;o<t;o+=1)f=document.createElement("div"),f.setAttribute("id",S+"_part_"+o),f.className="eyeCalendar_part",f.pid=this.father.pid,f.evenType="default",f.day=S,f.hour=n,f.num=o,f.addNote=y,f.addNoteToLevel=m,f.delNote=b,f.delNoteToLevel=g,f.notesLevel=[],f.numOfLevels=w,i.appendChild(f);n!==this.father.hourFrom&&(i.style.borderTop="1px #C1C1C1 solid"),r=document.createElement("div"),r.setAttribute("id","halfHour"),r.style.top=this.father.rowHeight/2+"px",r.className="eyeCalendar_halfHour",i.appendChild(r),E.appendChild(i),a+=1}this.daysContainer.appendChild(E);for(S=this.father.dayFrom+1;S<=this.father.dayEven-1;S+=1){E=E.cloneNode(!0),E.setAttribute("id",this.father.pid+"_day_"+S),E.style.borderLeft="1px #C1C1C1 solid",E.notes=[],E.orderNotes=p,E.addNote=d,E.delNote=v,s=E.childNodes,a=0;for(n=0;n<s.length;n+=1){s[n].setAttribute("id",this.father.pid+"_hour_"+S+"_"+n),o=a*4,t=o+4,l=s[n].childNodes;for(h=0;h<l.length;h+=1)l[h].id==="halfHour"?h=l.length:(l[h].setAttribute("id",S+"_part_"+o),l[h].num=o,l[h].day=S,l[h].hour=n,l[h].evenType="default",l[h].pid=this.father.pid,l[h].addNote=y,l[h].notesLevel=[],l[h].addNoteToLevel=m,l[h].delNote=b,l[h].delNoteToLevel=g,l[h].numOfLevels=w,o+=1);a+=1}this.totalParts=o,this.daysContainer.appendChild(E)}},this.draw_bodyDaysIE=function(){var e,t,n,r,i,s,o,u=function(){return!1};for(e=this.father.dayFrom;e<=this.father.dayEven-1;e+=1){o=document.createElement("div"),o.setAttribute("id",this.father.pid+"_day_"+e),o.style.position="relative",o.style.cssFloat="left",o.style.styleFloat="left",o.style.width=this.father.rowWidth+"px",o.style.height="100%",o.pid=this.father.pid,o.onselectstart=u,e!==this.father.dayFrom&&(o.style.borderLeft="1px #C1C1C1 solid"),i=0;for(n=this.father.hourFrom;n<=this.father.hourEven;n+=1){r=i*4,t=r+4;for(r;r<t;r+=1)s=document.createElement("div"),s.setAttribute("id",e+"_part_"+r),s.style.position="relative",s.style.cssFloat="left",s.style.styleFloat="left",s.style.width="100%",s.style.height=this.father.rowHeight/4+"px",s.pid=this.father.pid,s.day=e,s.hour=n,s.num=r,s.style.zIndex="1",s.notesInPart=[],r===t-1&&(s.style.borderBottom="1px #C1C1C1 solid"),s.evenType="default",o.appendChild(s);o.appendChild(s),i+=1}this.totalParts=r,this.daysContainer.appendChild(o)}},this.draw_dayHours=function(){var e,t,n,r=function(){return!1};for(e=this.father.hourFrom;e<=this.father.hourEven;e+=1)t=document.createElement("div"),t.setAttribute("id","hour"),t.style.position="relative",t.style.cssFloat="left",t.style.styleFloat="left",t.style.width="100%",IEversion&&IEversion<7?t.style.height=this.father.rowHeight+1+""+"px":t.style.height=this.father.rowHeight+"px",t.style.borderTop="1px #E6E6E6 solid",t.style.textAlign="center",t.style.color="#585858",IEversion&&(t.onselectstart=r),n=document.createTextNode(e+":00"),t.appendChild(n),this.hoursBase.appendChild(t)},this.goToFirstNote=function(){this.father.firstTop||(this.father.firstTop=xTop(this.hourLine)),this.fatherDays.scrollTop=this.father.firstTop},this.drawCurrentHour=function(){var e,t,n,r=new Date,i=r.getHours(),s=r.getMinutes(),o=r.getSeconds();if(i>this.father.hourEven)return!1;e=i*51,e+=s*.83,e=parseInt(e,10),this.hourLine=document.createElement("div"),this.hourLine.setAttribute("id",this.father.pid+"_currentHour"),this.hourLine.style.position="absolute",this.hourLine.style.top=e+"px",this.hourLine.style.left="0px",this.hourLine.style.width="100%",this.hourLine.style.height="1px",IEversion===6&&(this.hourLine.style.visibility="hidden",this.hourLine.style.display="none"),this.hourLine.style.backgroundColor="#ea614f",n=document.createElement("div"),n.setAttribute("id",this.father.pid+"_textContainer"),n.style.position="absolute",n.style.marginTop="-2.4%",n.style.left="5px",n.style.color="#ea614f",n.style.fontSize="10px",n.style.zIndex=1,s<10&&(s="0"+s),o<10&&(o="0"+o),t=document.createTextNode(i+":"+s+":"+o),n.appendChild(t),this.hourLine.appendChild(n),this.daysContainer.appendChild(this.hourLine),this.timeOut=setTimeout("calendar_updateCurrentHour("+this.father.pid+");",1e3)},this.updateCurrentHour=function(e){var t=new Date,n=t.getHours(),r=t.getMinutes(),i=t.getSeconds(),s=(n-this.father.hourFrom)*51;s+=r*.83,s=parseInt(s,10),this.hourLine.style.top=s+"px",IEversion===6&&(this.hourLine.style.visibility="visible",this.hourLine.style.display="block"),r<10&&(r="0"+r),i<10&&(i="0"+i),this.hourLine.firstChild.firstChild.data=n+":"+r+":"+i,this.timeOut=setTimeout("calendar_updateCurrentHour("+e+");",1e3)},this.draw=function(){this.hoursBase=document.createElement("div"),this.hoursBase.setAttribute("id",this.father.pid+"_hoursBase"),this.hoursBase.style.position="absolute",this.hoursBase.style.left="0px",this.hoursBase.onselectstart=function(){return!1},IEversion&&IEversion<7?this.hoursBase.style.top="6px":this.hoursBase.style.top="5px",this.hoursBase.style.width=this.father.hourRowWidth+"px",this.hoursBase.style.height="100%",this.fatherNames=document.createElement("dif"),this.fatherNames.setAttribute("id",this.father.pid+"_fatherNames"),this.fatherNames.style.position="absolute",this.fatherNames.style.left=this.father.hourRowWidth+"px",this.fatherNames.style.top="0px",this.fatherNames.style.width="auto",this.fatherNames.style.height="auto",this.fatherDays=document.createElement("dif"),this.fatherDays.setAttribute("id",this.father.pid+"_fatherDays"),this.fatherDays.style.position="absolute",this.fatherDays.style.left="0px",this.fatherDays.style.top="40px",this.fatherDays.style.width="100%",this.fatherDays.style.height=xHeight(this.father.father)+"px",this.fatherDays.style.overflowX="hidden",this.fatherDays.style.overflowY="auto",this.daysBase=document.createElement("div"),this.daysBase.setAttribute("id",this.father.pid+"_daysBase"),this.daysBase.style.position="absolute",this.daysBase.style.left=this.father.hourRowWidth+"px",this.daysBase.style.top="0px",this.daysBase.style.width=this.father.dayRowWidth+"px",this.daysBase.style.height=this.father.contentHeight+"px",IEversion&&(this.daysBase.onselectstart=function(){return!1}),this.dayNames=document.createElement("div"),this.dayNames.setAttribute("id",this.father.pid+"_dayNames"),this.dayNames.style.position="relative",this.dayNames.style.cssFloat="left",this.dayNames.style.styleFloat="left",this.dayNames.style.width="auto",this.dayNames.style.height="20px",IEversion&&(this.dayNames.onselectstart=function(){return!1}),this.dayTodo=document.createElement("div"),this.dayTodo.setAttribute("id",this.father.pid+"_dayTodo"),this.dayTodo.style.position="relative",this.dayTodo.style.cssFloat="left",this.dayTodo.style.styleFloat="left",this.dayTodo.style.width="auto",this.dayTodo.style.height="15px",this.dayTodo.style.border="1px #999 solid",IEversion&&(this.dayTodo.onselectstart=function(){return!1}),this.daysContainer=document.createElement("div"),this.daysContainer.setAttribute("id",this.father.pid+"_daysContent"),this.daysContainer.style.position="relative",this.daysContainer.style.cssFloat="left",this.daysContainer.style.styleFloat="left",this.daysContainer.style.marginTop="5px",this.daysContainer.style.width="100%",this.daysContainer.style.height="auto",this.daysContainer.style.borderLeft="1px #999 solid",this.daysContainer.style.borderRight="1px #999 solid",this.daysContainer.style.borderTop="1px #999 solid",this.daysContainer.style.borderBottom="1px #999 solid",IEversion&&(this.daysContainer.onselectstart=function(){return!1}),this.father.evenType="default",xAddEventListener(this.daysContainer,"mousedown",mouseDown),xAddEventListener(this.daysContainer,"mouseup",mouseUp),this.father.father.appendChild(this.fatherNames),this.father.father.appendChild(this.fatherDays),this.fatherNames.appendChild(this.dayNames),this.draw_dayNames(),this.fatherNames.appendChild(this.dayTodo),this.draw_todos(),this.fatherDays.appendChild(this.daysBase),this.fatherDays.appendChild(this.hoursBase),this.draw_dayHours(),this.daysBase.appendChild(this.daysContainer),this.drawCurrentHour(),IEversion&&IEversion<8?this.draw_bodyDaysIE():this.draw_bodyDays()}}function weekPlanner_calendars(e){this.father=e,this.calendarInfo=[],this.cleanCalendars=function(){var e=document.getElementById(this.father.pid+"_calendarsEntryContainer");e.parentNode.removeChild(e),this.draw()},this.hiddenNotes=function(e){var t,n,r;if(!e.target.num)return!1;t=e.target,n=t.num;if(t.checked===!0)this.calendarInfo[n].show=1,this.father.notes.jsEvent_showCalendarNotes(n);else{if(this.calendarInfo[n].selected===1)return t.checked=!0,!1;this.calendarInfo[n].show=0,this.father.notes.jsEvent_hiddenCalendarNotes(n)}r=eyeParam("showed",t.checked),r+=eyeParam("calendar",n),sendMsg(this.father.checknum,"calendarShow",r)},this.selectCalendar=function(e){var t,n,r,i=this.calendarInfo.length;i>0&&(n=xGetElementById(this.father.pid+"_selectedImg"),n.parentNode.removeChild(n)),r=e.target,r.id==="textContainer"&&(r=r.parentNode),t=r.num,this.genSelectCalendar(!0,r,t)},this.phpSelectCalendar=function(e){var t,n,r=this.calendarInfo.length;r>0&&(n=xGetElementById(this.father.pid+"_selectedImg"),n.parentNode.removeChild(n)),t=document.getElementById(this.father.pid+"_contentName_"+e),this.genSelectCalendar(!1,t,e)},this.genSelectCalendar=function(e,t,n){var r,i,s;this.father.selectedCalendar!=="noCalendar"&&(this.calendarInfo[this.father.selectedCalendar].selected=0),this.calendarInfo[n].selected=1,this.calendarInfo[n].show===0&&(r=document.getElementById(this.father.pid+"_calendarCheck_"+n),r.checked=!0,this.calendarInfo[n].show=1,this.father.notes.jsEvent_showCalendarNotes(n),s=eyeParam("showed",r.checked),s+=eyeParam("calendar",n),sendMsg(this.father.checknum,"calendarShow",s)),this.calendarInfo[n].selected=1,this.father.selectedCalendar=n,i=this.drawSelectRow(),t.appendChild(i),e===!0&&(s=eyeParam("calendar",n),sendMsg(this.father.checknum,"selectCalendar",s))},this.drawSelectRow=function(){var e,t=document.createElement("div");return t.setAttribute("id",this.father.pid+"_selectedImg"),t.style.position="absolute",t.style.height="100%",t.style.right="5px",e=document.createElement("img"),e.src="index.php?theme="+USERTHEME+"&extern=images/apps/eyeCalendar/widget/selected.png",e.setAttribute("id",this.father.pid+"_selectedImg_img"),t.appendChild(e),t},this.drawCalendar=function(e,t,n){var r,i,s,o,u,a,f,l,c=this.father.calendarsFather;this.calendarInfo[t]=[],this.calendarInfo[t].show=n,s=document.createElement("div"),s.setAttribute("id",t+"_contentEntry"),s.style.cssFloat="right",s.style.styleFloat="right",s.style.width=this.father.calendarsFatherWidth-20+"px",s.style.height="15px",s.style.marginTop="5px",s.style.zIndex="999",s.style.cursor="pointer",s.num=t,s.pid=this.father.pid,s.evenType="selectCalendar",i=document.createElement("input"),i.setAttribute("id",this.father.pid+"_calendarCheck_"+t),i.style.position="relative",i.style.cssFloat="left",i.style.styleFloat="left",i.style.marginTop="1px",i.style.marginLeft="0px",i.style.marginRight="0px",i.style.cursor="pointer",i.type="checkBox",i.evenType="viewCalendar",i.noPrevent=!0,i.num=t,i.pid=this.father.pid,n===1&&(i.checked=!0,i.defaultChecked=!0),xAddEventListener(i,"click",mouseClick),o=document.createElement("div"),o.setAttribute("id",this.father.pid+"_contentName_"+t),o.style.position="relative",o.style.cssFloat="left",o.style.styleFloat="left",o.style.marginLeft="5px",o.style.width=this.father.calendarsFatherWidth-48+"px",IEversion&&IEversion<7?o.style.height="16px":o.style.height="100%",o.style.color="white",IEversion&&IEversion<7&&(o.style.marginTop="4px"),o.evenType="selectCalendar",o.pid=this.father.pid,o.num=t,a=document.createElement("div"),a.style.position="absolute",a.style.width="1px",a.style.height="1px",a.style.backgroundColor="white",a.style.top="0px",a.style.left="0px",o.appendChild(a),a=a.cloneNode(!0),a.style.top="",a.style.bottom="0px",o.appendChild(a),a=a.cloneNode(!0),a.style.left="",a.style.right="0px",o.appendChild(a),a=a.cloneNode(!0),a.style.bottom="",a.style.top="0px",o.appendChild(a),t>5?r=t%5:r=t,o.style.backgroundColor=this.father.calendarSelectColors[r],l=document.createElement("div"),l.setAttribute("id","textContainer"),l.style.cssFloat="left",l.style.styleFloat="left",l.style.marginLeft="4px",l.evenType="selectCalendar",l.pid=this.father.pid,f=document.createTextNode(e),l.appendChild(f),xAddEventListener(l,"click",mouseClick),this.father.selectedCalendar===t?(this.calendarInfo[t].selected=1,u=this.drawSelectRow(),o.appendChild(u)):this.calendarInfo[t].selected=0,o.appendChild(l),s.appendChild(i),s.appendChild(o),xAddEventListener(o,"click",mouseClick),this.infoContainer.appendChild(s)},this.draw=function(){var e,t,n=this.father.calendarsFather,r=document.createElement("div");r.setAttribute("id",this.father.pid+"_calendarsEntryContainer"),r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.height="100%",r.style.width="100%",r.style.backgroundColor="white",t=document.createElement("div"),t.style.position="absolute",t.style.top="5px",t.style.left="10px",t.style.width="auto",t.style.height="10px",t.style.color="#6D6D6D",e=document.createTextNode(this.father.calendarsText),t.appendChild(e),r.appendChild(t),this.infoContainer=document.createElement("div"),this.infoContainer.style.position="absolute",this.infoContainer.style.left="3px",this.infoContainer.style.top="26px",this.infoContainer.style.width=this.father.calendarsFatherWidth-14+"px",this.infoContainer.style.height="auto",r.appendChild(this.infoContainer),n.appendChild(r)}}function weekPlanner_close(e){return weekPlanner_instances[e]?(clearTimeout(weekPlanner_instances[e].base.timeOut),IEversion&&IEversion<8?(weekPlanner_instances[e].base.father=null,weekPlanner_instances[e]=null):(delete weekPlanner_instances[e].base.father,delete weekPlanner_instances[e]),!0):!1}function weekPlanner_events(e){this.father=e,this.mouseDown=function(e){var t="";if(this.father&&this.father.evenType){this.father.evenType==="default"?e.target.evenType!=="default"&&e.target.evenType!==""?t=e.target.evenType:t="default":t=this.father.evenType;if(t==="editingEvent"){if(e.target.evenType==="editEvent"||e.target.evenType==="changeEvent"||e.target.evenType==="cancelEvent")return this.father.evenType="default",!0;this.father.notes.jsEvent_cancelEvent(e)}else if(t==="nothingToDo")return this.father.evenType="default",!0}if(e&&e.target&&e.target.id&&e.target.id!==""){if(e.target.id==="noteTitle")return this.father.notes.jsEvent_moveNote(e),!0;if(e.target.id==="noteBottom")return this.father.notes.jsEvent_resizeNote(e),!0}if(t==="moveNote")return this.father.notes.jsEvent_moveNote(e),!0;if(t==="default")return this.father.notes.jsEvent_newNote(e),!0},this.mouseUp=function(e){if(!this.father.tmpNote)return!1;this.father.base.daysContainer.style.cursor="pointer",this.father.tmpNote.noteBody.style.zIndex=3,IEversion&&IEversion<8&&(this.father.tmpNote.style.zIndex=2),this.father.tmpNote.lastPart&&(IEversion&&IEversion<8?this.father.tmpNote.lastPart=null:delete this.father.tmpNote.lastPart),xRemoveEventListener(this.father.base.daysContainer,"mouseover",mouseOver),xAddEventListener(this.father.base.daysContainer,"mousedown",mouseDown);if(this.father.evenType==="resizeNote2")this.father.evenType="default",this.father.notes.jsEvent_noteCreated(e);else if(this.father.evenType==="resizeNote")this.father.evenType="default",this.father.notes.jsEvent_noteResized(e);else{if(this.father.evenType!=="moveNote"&&this.father.evenType!=="moveNoteBody")return this.father.evenType="default",!1;this.father.evenType="default",this.father.notes.jsEvent_noteMoved(e)}},this.mouseOver=function(e){var t="";this.father&&this.father.evenType&&this.father.evenType==="default"?e.target.evenType!=="default"&&e.target.evenType!==""?t=e.target.evenType:t="default":t=this.father.evenType,t==="resizeNote"||t==="resizeNote2"?this.father.notes.reCall_resizingNote(e):t==="moveNote"?this.father.notes.reCall_movingNote(e):t==="moveNoteBody"&&this.father.notes.reCall_movingNoteBody(e)},this.mouseClick=function(e){var t="";this.father&&this.father.evenType&&this.father.evenType==="default"||this.father.evenType==="editingEvent"?e.target.evenType!=="default"&&e.target.evenType!==""?t=e.target.evenType:t="default":t=this.father.evenType;if(t==="changeEvent")this.father.notes.jsEvent_setEvent(e);else if(t==="editEvent")this.father.notes.jsEvent_editEvent(e);else if(t==="cancelEvent")this.father.notes.jsEvent_cancelEvent(e);else if(t==="selectCalendar")this.father.calendars.selectCalendar(e);else if(t==="viewCalendar")this.father.calendars.hiddenNotes(e);else if(t==="deleteNote")this.father.notes.jsEvent_deleteNote(e);else if(t==="nothingToDo")return!1},this.keyPress=function(e){var t="";this.father&&this.father.evenType&&this.father.evenType==="default"||this.father.evenType==="editingEvent"?e.target.evenType!=="default"&&e.target.evenType!==""?t=e.target.evenType:t="default":t=this.father.evenType,t==="changeEvent"&&e.keyCode===13&&this.father.notes.jsEvent_setEvent(e)}}function weekPlanner_notes(e){this.father=e,this.notes=[],this.jsEvent_newNote=function(e){var t,n,r,i,s,o,u;if(isNaN(e.target.num))return!1;this.father.evenType="default",t=this.father.selectedCalendar,u=e.target,o=0,o=Math.floor(u.num/this.father.parts),u.num>3?o=u.num-o*this.father.parts:o=u.num,s=u.num,n=this.notes.length,i=this.draw_newNote(s,2,t,n,1,1),this.father.base.daysContainer.style.cursor="s-resize",r=document.getElementById(this.father.pid+"_day_"+u.day),r.appendChild(i),i.parts=2,i.fromParts=u.num,i.startPart=u.num,i.day=u.day,i.startPartObj=xGetElementById(u.day+"_part_"+u.num),this.draw_title(i),this.draw_event(i,this.father.defaultEvenText),IEversion&&IEversion<8?(i.style.zIndex=0,i.noteBody.style.zIndex=0):i.noteBody.style.zIndex=1,this.father.tmpNote=i,this.notes.push(i),i.cid=n,i.calendar=t,i.newFather=r,this.father.evenType="resizeNote2",xAddEventListener(this.father.base.daysContainer,"mouseover",mouseOver),xRemoveEventListener(this.father.base.daysContainer,"mousedown",mouseDown)},this.draw_contextualMenu=function(e){var t=[];t.sFather=1,IEversion&&IEversion<8&&(t.mFather=this.father.base.daysContainer.id,t.rFather=this.father.base.daysContainer.id),ContextMenu_show(t,e.cid+"_noteMenu",e.id,20,20,0,0,this.father.checknum,0),addContextEntry(e.cid+"_noteMenu",'<img id="'+e.cid+'_noteMenu_delete" style="height: 16px; width: 16px;" src="index.php?theme='+USERTHEME+'&extern=icons/16x16/delete.png"/> &nbsp;&nbsp;$lang:Delete',e.cid+"_delete","delNote",this.father.checknum,"<id>"+e.cid+"</id><calendar>"+e.calendar+"</calendar>",e.cid+"_noteMenu_delete")},this.jsEvent_deleteNote=function(e){var t,n=e.target.parentNode;n.newFather.delNote(n),t=eyeParam("id",n.cid),t+=eyeParam("calendar",n.calendar),sendMsg(this.father.checknum,"delNote",t)},this.jsEvent_resizeNote=function(e){this.father.tmpNote=e.target.parentNode,this.father.evenType="resizeNote",IEversion&&IEversion<8?(this.father.tmpNote.style.zIndex=0,this.father.tmpNote.noteBody.style.zIndex=0):this.father.tmpNote.noteBody.style.zIndex=1,this.father.base.daysContainer.style.cursor="s-resize",xAddEventListener(this.father.base.daysContainer,"mouseover",mouseOver)},this.jsEvent_moveNote=function(e){this.father.tmpNote=e.target.parentNode,e.target.id==="noteTitle"?this.father.evenType="moveNote":this.father.evenType="moveNoteBody",IEversion&&IEversion<8?(this.father.tmpNote.style.zIndex=0,this.father.tmpNote.noteBody.style.zIndex=0):this.father.tmpNote.noteBody.style.zIndex=1,this.father.base.daysContainer.style.cursor="move",xAddEventListener(this.father.base.daysContainer,"mouseover",mouseOver)},this.jsEvent_editEvent=function(e){var t,n,r=e.target.parentNode;r=r.parentNode,this.father.tmpNote=r,n=e.target.firstChild.data,xRemoveEventListener(this.father.base.daysContainer,"mouseover",mouseOver),xRemoveEventListener(this.father.base.daysContainer,"mouseup",mouseUp),t=this.draw_editPopup(r.cid,n),this.father.father.parentNode.appendChild(t),t.inputText.focus(),t.inputText.select()},this.jsEvent_addNoteToPart=function(e){var t,n,r=e.startPart,i=e.parts,s=r+i,o=e.day,u=0;for(n=r;n<s;n+=1)t=xGetElementById(o+"_part_"+n),t.notesInPart.push(e),t.notesInPart.length>u&&(u=t.notesInPart.length);e.style.width=90/u+"%"},this.jsEvent_noteCreated=function(){var e,t,n=this.father.tmpNote;this.draw_contextualMenu(n),n.newFather.addNote(n),t=eyeParam("hourFrom",n.hourFrom),t+=eyeParam("minFrom",n.minFrom),t+=eyeParam("hourEven",n.hourEven),t+=eyeParam("minEven",n.minEven),t+=eyeParam("day",n.day),t+=eyeParam("id",n.cid),t+=eyeParam("calendar",n.calendar),sendMsg(this.father.checknum,"addNote",t),xRemoveEventListener(this.father.base.daysContainer,"mouseover",mouseOver),xRemoveEventListener(this.father.base.daysContainer,"mouseup",mouseUp),e=this.draw_editPopup(n.cid),this.father.father.parentNode.appendChild(e),e.inputText.focus(),e.inputText.select()},this.draw_editBox=function(e){var t=document.createElement("div");return t.setAttribute("id","eventCotnainer"),t.className="eyeCalendar_hover",t.style.position="relative",t.style.paddingLeft="1px",t.style.paddingRight="1px",t.style.width="auto",t.style.height="auto",t.style.color="white",t.style.cursor="pointer",t.evenType="editEvent",t.style.zIndex="999",t.pid=this.father.pid,e=document.createTextNode(e),t.appendChild(e),xAddEventListener(t,"click",mouseClick),t},this.jsEvent_setEvent=function(e){var t,n,r,i,s=this.father.tmpNote.cid,o=document.getElementById(s+"_inputEvent");if(!o)return!1;i=this.draw_editBox(o.value),xAddEventListener(i,"click",mouseClick),this.father.tmpNote.noteBody.firstChild&&this.father.tmpNote.noteBody.removeChild(this.father.tmpNote.noteBody.firstChild),this.father.tmpNote.noteBody.appendChild(i),n=e.target.parentNode,n.parentNode.removeChild(n),t=this.father.tmpNote,r=eyeParam("title",o.value),r+=eyeParam("id",t.cid),r+=eyeParam("calendar",t.calendar),sendMsg(this.father.checknum,"updateTitle",r),this.father.evenType="default",xAddEventListener(this.father.base.daysContainer,"mousedown",mouseDown),xAddEventListener(this.father.base.daysContainer,"mouseup",mouseUp)},this.jsEvent_noteResized=function(){var e,t;xRemoveEventListener(this.father.base.daysContainer,"mouseover",mouseOver),e=this.father.tmpNote,t=eyeParam("hourFrom",e.hourFrom),t+=eyeParam("minFrom",e.minFrom),t+=eyeParam("hourEven",e.hourEven),t+=eyeParam("minEven",e.minEven),t+=eyeParam("day",e.day),t+=eyeParam("id",e.cid),t+=eyeParam("calendar",e.calendar),sendMsg(this.father.checknum,"resizeNote",t),this.father.evenType="default"},this.jsEvent_noteMoved=function(){var e,t;xRemoveEventListener(this.father.base.daysContainer,"mouseover",mouseOver),e=this.father.tmpNote,t=eyeParam("hourFrom",e.hourFrom),t+=eyeParam("minFrom",e.minFrom),t+=eyeParam("hourEven",e.hourEven),t+=eyeParam("minEven",e.minEven),t+=eyeParam("day",e.day),t+=eyeParam("id",e.cid),t+=eyeParam("calendar",e.calendar),sendMsg(this.father.checknum,"moveNote",t),this.father.evenType="default"},this.jsEvent_cancelEvent=function(){var e=document.getElementById(this.father.tmpNote.cid+"_popupDiv"),t=e.parentNode;t.removeChild(e),this.father.evenType="default",xAddEventListener(this.father.base.daysContainer,"mousedown",mouseDown),xAddEventListener(this.father.base.daysContainer,"mouseup",mouseUp)},this.jsEvent_hiddenCalendarNotes=function(e){var t,n;for(t=0;t<this.notes.length;t+=1)n=this.notes[t],n.calendar===e&&(n.style.visibility="hidden",n.style.display="none")},this.jsEvent_showCalendarNotes=function(e){var t,n;for(t=0;t<this.notes.length;t+=1)n=this.notes[t],n.calendar===e&&(n.style.visibility="visible",n.style.display="block")},this.reCall_resizingNote=function(e){var t,n;if(!e.target.num)return!1;n=e.target,t=this.father.tmpNote,t.parts!==n.num+1&&n.num>=t.startPart&&(t.parts=t.parts+n.num-t.fromParts,t.fromParts=n.num,this.draw_resizeNote(t),this.draw_title(t))},this.reCall_movingNote=function(e){var t,n,r,i,s;if(isNaN(e.target.num))return!1;s=e.target,t=s.day,this.father.tmpNote.day=t,i=document.getElementById(this.father.pid+"_day_"+t),r=0,r=Math.floor(s.num/this.father.parts),s.num>3?r=s.num-r*this.father.parts:r=s.num,n=s.num+this.father.tmpNote.parts,n-=1;if(n>=this.father.base.totalParts)return!1;this.father.tmpNote.startPart=s.num,this.father.tmpNote.fromParts=s.num+this.father.tmpNote.parts,this.draw_movedNote(i,this.father.tmpNote.startPart),this.draw_title(this.father.tmpNote)},this.reCall_movingNoteBody=function(e){var t,n,r,i,s;if(isNaN(e.target.num))return!1;if(!this.father.tmpNote.lastPart)return this.father.tmpNote.lastPart=e.target,!1;n=e.target.num-this.father.tmpNote.lastPart.num,t=e.target.day,this.father.tmpNote.lastPart=e.target,this.father.tmpNote.startPart+=n,s=document.getElementById(t+"_part_"+this.father.tmpNote.startPart);if(!s||isNaN(s.day))return!1;t=s.day,this.father.tmpNote.day=t,i=document.getElementById(this.father.pid+"_day_"+t),r=0,r=Math.floor(s.num/this.father.parts),s.num>3?r=s.num-r*this.father.parts:r=s.num,this.father.tmpNote.startPart=s.num,this.father.tmpNote.fromParts=s.num+this.father.tmpNote.parts,this.draw_movedNote(i,this.father.tmpNote.startPart),this.draw_title(this.father.tmpNote)},this.phpEvent_newNote=function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p,d,v,m,g,y,b;t=parseInt(t,10),d=n-t,v=i-r,y=d*60+v,h=Math.floor(r/15),b=(t-this.father.hourFrom)*4,b+=h,g=Math.floor(y/15),m=this.draw_newNote(b,g,u,s,a,f),c=b+g,m.parts=g,m.fromParts=c,m.startPart=b,m.startPartObj=xGetElementById(e+"_part_"+b),m.day=e,m.cid=s,m.calendar=u,l===1&&this.draw_title(m),o===" "&&(o=this.father.defaultEvenText),this.draw_event(m,o),p=document.getElementById(this.father.pid+"_day_"+e),p.appendChild(m),m.newFather=p,this.draw_contextualMenu(m),this.notes.push(m),p.addNote(m)},this.phpEvent_cleanNotes=function(){var e,t,n;for(e=0;e<this.notes.length;e+=1)t=this.notes[e],n=t.parentNode,n.removeChild(t);this.notes=[]},this.phpEvent_deleteNote=function(e){var t,n;for(t=0;t<this.notes.length;t+=1)n=this.notes[t],n.cid===e&&n.parentNode.removeChild(n)},this.phpEvent_deleteCalendarNotes=function(e){var t,n;for(t=0;t<this.notes.length;t+=1)n=this.notes[t],n.calendar===e&&(n.parentNode.removeChild(n),delete this.notes[t])},this.draw_title=function(e){var t,n,r,i,s,o,u,a=e.firstChild,f=e.parts,l=e.startPart,c=l/4,h=parseInt(c,10);this.father.hourFrom!==0&&(h=parseInt(this.father.hourFrom,10)+h,c+=parseFloat(this.father.hourFrom)),o=c-h,s=o*60,n=f/4,n+=c,t=parseInt(n,10),i=n-t,r=i*60,h<10&&(h="0"+h),t<10&&(t="0"+t),s<10&&(s="0"+s),r<10&&(r="0"+r),a.firstChild?(u=a.firstChild,u.data=h+":"+s+"-"+t+":"+r):(u=document.createTextNode(h+":"+s+"-"+t+":"+r),a.appendChild(u)),e.hourFrom=h,e.hourEven=t,e.minFrom=s,e.minEven=r},this.draw_movedNote=function(e,t){var n,r=this.father.tmpNote,i=this.father.pixelPart;IEversion===6&&(i+=.5),n=t*i,n=Math.floor(n),r.style.top=n+"px",e.appendChild(r)},this.draw_newNote=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;n||(n=1),c=this.father.pixelPart,c*=t,h=this.father.pixelPart,IEversion===6&&(h+=.5,t>2?f=t+3:f=t+2,c+=f),b=e*h,u=c-this.father.pixelPart-2,p=document.createElement("div"),n>5?a=n%5:a=n,o=this.father.noteBodyColors[a],l=this.father.noteHeaderColors[a];if(!this.father.firstTop||this.father.firstTop>b)w=0,w=this.father.pixelPart*7,this.father.firstTop=b-w;return p.setAttribute("id",this.father.pid+"_note_"+r),p.style.position="absolute",p.style.top=b+"px",p.style.left="-1px",p.style.width="100%",p.pid=this.father
.pid,p.style.height=c+"px",IEversion&&IEversion<8&&(p.style.zIndex="2"),p.pid=this.father.pid,g=document.createElement("div"),g.setAttribute("id","noteTitle"),g.style.cursor="move",i!==1&&(g.evenType="nothingToDo",g.style.cursor="default"),g.setAttribute("id","noteTitle"),g.style.backgroundColor=l,g.style.position="absolute",g.style.top="0px",g.style.height=this.father.pixelPart+"px",g.style.width="100%",g.style.borderRight="1px "+l+" solid",g.style.borderLeft="1px "+l+" solid",g.style.zIndex="4",g.style.color="white",g.style.fontSize="80%",g.style.textIndent="4px",g.style.fontWeight="bold",g.style.lineHeight="1.4em",IEversion&&(g.onselectstart=function(){return!1}),p.noteHeader=g,p.appendChild(g),y=document.createElement("div"),y.setAttribute("id","noteRemove"),y.style.position="absolute",y.style.backgroundRepeat="no-repeat",y.style.backgroundImage="url(index.php?theme="+USERTHEME+"&extern=images/apps/eyeCalendar/deleteNote.png)",y.style.top="0px",y.style.right="0px",y.style.height=this.father.pixelPart+"px",y.style.width="10px",y.style.zIndex="4",y.style.cursor="pointer",y.style.color="white",y.evenType="deleteNote",xAddEventListener(y,"click",mouseClick),p.appendChild(y),v=c-this.father.pixelPart,d=document.createElement("div"),d.setAttribute("id","noteBody"),d.style.position="absolute",d.style.top=this.father.pixelPart+"px",d.style.backgroundColor=o,d.style.height=v+"px",d.style.width="100%",d.style.borderRight="1px "+l+" solid",d.style.zIndex="3",d.style.borderLeft="1px "+l+" solid",d.style.borderRight="1px "+l+" solid",s===1?(d.style.cursor="move",d.evenType="moveNote"):(d.evenType="nothingToDo",d.style.cursor="default"),p.noteBody=d,p.appendChild(d),m=document.createElement("div"),m.setAttribute("id","noteBottom"),m.style.cursor="s-resize",i!==1&&(m.evenType="nothingToDo",m.style.cursor="default"),m.style.position="absolute",m.style.bottom="0px",m.style.height="2px",m.style.width="100%",m.style.zIndex="4",m.style.left="1px",m.style.borderBottom="1px "+l+" solid",p.noteBottom=m,p.appendChild(m),this.father.calendars.calendarInfo[n].show===0&&(p.style.visibility="hidden",p.style.display="none"),p},this.draw_resizeNote=function(e){var t,n=this.father.pixelPart;IEversion===6&&(n+=.5),t=e.parts*n,e.style.height=t+"px",e.noteBody.style.height=t-this.father.pixelPart+"px"},this.draw_event=function(e,t){var n=this.draw_editBox(t);e.noteBody.appendChild(n)},this.draw_editPopup=function(e,t){var n,r,i,s=xWidth(this.father.father),o=xHeight(this.father.father),u=o/2-50,a=s/2-100+168,f=document.createElement("div");return f.setAttribute("id",e+"_popupDiv"),f.style.position="absolute",f.style.top=u+"px",f.style.left=a+"px",f.style.height="110px",f.style.width="250px",f.style.backgroundColor="white",f.style.border="1px solid gray",f.style.zIndex="999",i=document.createElement("div"),i.setAttribute("id","inputText"),i.style.marginLeft="15px",i.style.marginTop="10px",i.innerHTML="$lang:Text for this event:",r=document.createElement("input"),r.setAttribute("id",e+"_inputEvent"),r.type="text",t&&(r.value=t),r.className="eyeTextbox",r.style.width="220px",r.style.marginLeft="15px",r.style.marginTop="10px",r.evenType="changeEvent",r.noPrevent=!0,r.pid=this.father.pid,xAddEventListener(r,"keypress",keyPress),f.appendChild(i),f.appendChild(r),f.inputText=r,n=document.createElement("button"),n.setAttribute("id","buttonEvent"),n.className="eyeButtonClass",n.style.position="absolute",n.style.width="70px",n.style.bottom="15px",n.style.right="15px",n.innerHTML="$lang:Accept",n.pid=this.father.pid,n.evenType="changeEvent",xAddEventListener(n,"click",mouseClick),f.appendChild(n),n=document.createElement("button"),n.setAttribute("id","buttonEvent"),n.className="eyeButtonClass",n.style.position="absolute",n.style.width="70px",n.style.bottom="15px",n.style.right="100px",n.innerHTML="$lang:Cancel",n.pid=this.father.pid,n.evenType="cancelEvent",xAddEventListener(n,"click",mouseClick),f.appendChild(n),this.father.evenType="editingEvent",f}}function weekPlanner_class(e,t,n,r,i,s,o,u){var a,f,l,c;this.pid=e.pid,this.checknum=u,this.dayFrom=e.dayFrom,this.dayEven=e.dayEven,this.hourFrom=e.hourFrom,this.hourEven=e.hourEven,this.hourRowWidth=e.hourWidth,this.dayRowWidth=e.width,this.rowHeight=e.rowHeight,this.parts=e.parts,this.weekDays=getArrayArg(e.weekDays),this.startMonday=e.startMonday,this.selectedCalendar=e.selectedCalendar,this.defaultEvenText=e.defaultEvenText,this.calendarsText=e.calendarsText,this.father=xGetElementById(n),this.plannerWidth=xWidth(this.father),this.numDays=this.dayEven-this.dayFrom,a=xHeight(this.father),f=this.hourEven-this.hourFrom+1,c=this.rowHeight*f,c<a&&(this.rowHeight=a/f),IEversion===7?this.pixelPart=(this.rowHeight-1)/this.parts:this.pixelPart=(this.rowHeight+1)/this.parts,this.calendarsFather=xGetElementById(this.pid+"_calendarsContainer_Container"),this.calendarsFatherWidth=xWidth(this.calendarsFather),IEversion===6?this.rowHeight+=2:IEversion===7&&(this.rowHeight-=2),this.noteHeaderColors=["#AB3F19","#136DBB","#2E8200","#504A76","#AB3F19","#7F405C"],this.noteBodyColors=["#E46F46","#37A3FF","#6FBA32","#8074C9","#F19A2A","#E26299"],this.calendarSelectColors=["#E46F46","#37A3FF","#6FBA32","#8074C9","#F19A2A","#E26299"],this.contentHeight=this.rowHeight*(this.hourEven-this.hourFrom+1)+25,l=this.numDays-1+.2,this.rowWidth=(this.dayRowWidth-l)/this.numDays,this.calendars=new weekPlanner_calendars(this),this.events=new weekPlanner_events(this),this.base=new weekPlanner_base(this),this.notes=new weekPlanner_notes(this),this.calendars.draw(),this.base.draw(),this.resizeDays=e.resizeDays}function weekPlanner_show(e,t,n,r,i,s,o,u,a){var f=e.pid;weekPlanner_instances[f]=new weekPlanner_class(e,t,n,r,i,s,o,u,a)}function onResizeEyeCalendar(e){weekPlanner_instances[e].resizeDays()}function onAddCalendar(e,t,n,r){weekPlanner_instances[e].calendars.drawCalendar(t,n,r)}function onAddNoteCalendar(e,t,n,r,i,s,o,u,a,f,l,c){weekPlanner_instances[e].notes.phpEvent_newNote(t,n,r,i,s,o,u,a,f,l,c)}function onChangeDateCalendar(e,t,n,r){weekPlanner_instances[e].base.changeDate(t,n,r)}function onCleanCalendars(e){weekPlanner_instances[e].calendars.cleanCalendars()}function onCleanNotesCalendar(e){weekPlanner_instances[e].notes.phpEvent_cleanNotes()}function onDeleteCalendarNotes(e,t){weekPlanner_instances[e].notes.phpEvent_deleteCalendarNotes(t)}function onDeleteNote(e,t){weekPlanner_instances[e].notes.phpEvent_deleteNote(t)}function onGoToFirstNote(e){weekPlanner_instances[e].base.goToFirstNote()}function onHiddenNotesCalendar(e,t){weekPlanner_instances[e].notes.jsEvent_hiddenCalendarNotes(t)}function onSelectCalendar(e,t){weekPlanner_instances[e].calendars.phpSelectCalendar(t)}function onShowNotesCalendar(e,t){weekPlanner_instances[e].notes.jsEvent_showCalendarNotes(t)}function init_calendar(){sendMsg(eyeCalendarChecknum,"Launch","")}var weekPlanner_instances=[];init_calendar();