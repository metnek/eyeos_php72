function preinit(){var e;(e=tinyMCEPopup.getParam("external_link_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>')}function changeClass(){var e=document.forms[0];e.classes.value=getSelectValue(e,"classlist")}function init(){var e,t,n,r,i,s,o,u;tinyMCEPopup.resizeToInnerSize(),e=document.forms[0],t=tinyMCEPopup.editor,n=t.selection.getNode(),r="insert",document.getElementById("hrefbrowsercontainer").innerHTML=getBrowserHTML("hrefbrowser","href","file","advlink"),document.getElementById("popupurlbrowsercontainer").innerHTML=getBrowserHTML("popupurlbrowser","popupurl","file","advlink"),document.getElementById("targetlistcontainer").innerHTML=getTargetListHTML("targetlist","target"),i=getLinkListHTML("linklisthref","href"),i==""?document.getElementById("linklisthrefrow").style.display="none":document.getElementById("linklisthrefcontainer").innerHTML=i,i=getAnchorListHTML("anchorlist","href"),i==""?document.getElementById("anchorlistrow").style.display="none":document.getElementById("anchorlistcontainer").innerHTML=i,isVisible("hrefbrowser")&&(document.getElementById("href").style.width="260px"),isVisible("popupurlbrowser")&&(document.getElementById("popupurl").style.width="180px"),n=t.dom.getParent(n,"A"),n==null&&(s=t.dom.create("p",null,t.selection.getContent()),s.childNodes.length===1&&(n=s.firstChild)),n!=null&&n.nodeName=="A"&&(r="update"),e.insert.value=tinyMCEPopup.getLang(r,"Insert",!0),setPopupControlsDisabled(!0),r=="update"?(o=t.dom.getAttrib(n,"href"),u=t.dom.getAttrib(n,"onclick"),setFormValue("href",o),setFormValue("title",t.dom.getAttrib(n,"title")),setFormValue("id",t.dom.getAttrib(n,"id")),setFormValue("style",t.dom.getAttrib(n,"style")),setFormValue("rel",t.dom.getAttrib(n,"rel")),setFormValue("rev",t.dom.getAttrib(n,"rev")),setFormValue("charset",t.dom.getAttrib(n,"charset")),setFormValue("hreflang",t.dom.getAttrib(n,"hreflang")),setFormValue("dir",t.dom.getAttrib(n,"dir")),setFormValue("lang",t.dom.getAttrib(n,"lang")),setFormValue("tabindex",t.dom.getAttrib(n,"tabindex",typeof n.tabindex!="undefined"?n.tabindex:"")),setFormValue("accesskey",t.dom.getAttrib(n,"accesskey",typeof n.accesskey!="undefined"?n.accesskey:"")),setFormValue("type",t.dom.getAttrib(n,"type")),setFormValue("onfocus",t.dom.getAttrib(n,"onfocus")),setFormValue("onblur",t.dom.getAttrib(n,"onblur")),setFormValue("onclick",u),setFormValue("ondblclick",t.dom.getAttrib(n,"ondblclick")),setFormValue("onmousedown",t.dom.getAttrib(n,"onmousedown")),setFormValue("onmouseup",t.dom.getAttrib(n,"onmouseup")),setFormValue("onmouseover",t.dom.getAttrib(n,"onmouseover")),setFormValue("onmousemove",t.dom.getAttrib(n,"onmousemove")),setFormValue("onmouseout",t.dom.getAttrib(n,"onmouseout")),setFormValue("onkeypress",t.dom.getAttrib(n,"onkeypress")),setFormValue("onkeydown",t.dom.getAttrib(n,"onkeydown")),setFormValue("onkeyup",t.dom.getAttrib(n,"onkeyup")),setFormValue("target",t.dom.getAttrib(n,"target")),setFormValue("classes",t.dom.getAttrib(n,"class")),u!=null&&u.indexOf("window.open")!=-1?parseWindowOpen(u):parseFunction(u),selectByValue(e,"dir",t.dom.getAttrib(n,"dir")),selectByValue(e,"rel",t.dom.getAttrib(n,"rel")),selectByValue(e,"rev",t.dom.getAttrib(n,"rev")),selectByValue(e,"linklisthref",o),o.charAt(0)=="#"&&selectByValue(e,"anchorlist",o),addClassesToList("classlist","advlink_styles"),selectByValue(e,"classlist",t.dom.getAttrib(n,"class"),!0),selectByValue(e,"targetlist",t.dom.getAttrib(n,"target"),!0)):addClassesToList("classlist","advlink_styles")}function checkPrefix(e){e.value&&Validator.isEmail(e)&&!/^\s*mailto:/i.test(e.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_email"))&&(e.value="mailto:"+e.value),/^\s*www\./i.test(e.value)&&confirm(tinyMCEPopup.getLang("advlink_dlg.is_external"))&&(e.value="http://"+e.value)}function setFormValue(e,t){document.forms[0].elements[e].value=t}function parseWindowOpen(e){var t,n,r,i=document.forms[0];e.indexOf("return false;")!=-1?(i.popupreturn.checked=!0,e=e.replace("return false;","")):i.popupreturn.checked=!1,t=parseLink(e),t!=null&&(i.ispopup.checked=!0,setPopupControlsDisabled(!1),n=parseOptions(t.options),r=t.url,i.popupname.value=t.target,i.popupurl.value=r,i.popupwidth.value=getOption(n,"width"),i.popupheight.value=getOption(n,"height"),i.popupleft.value=getOption(n,"left"),i.popuptop.value=getOption(n,"top"),i.popupleft.value.indexOf("screen")!=-1&&(i.popupleft.value="c"),i.popuptop.value.indexOf("screen")!=-1&&(i.popuptop.value="c"),i.popuplocation.checked=getOption(n,"location")=="yes",i.popupscrollbars.checked=getOption(n,"scrollbars")=="yes",i.popupmenubar.checked=getOption(n,"menubar")=="yes",i.popupresizable.checked=getOption(n,"resizable")=="yes",i.popuptoolbar.checked=getOption(n,"toolbar")=="yes",i.popupstatus.checked=getOption(n,"status")=="yes",i.popupdependent.checked=getOption(n,"dependent")=="yes",buildOnClick())}function parseFunction(e){var t=document.forms[0],n=parseLink(e)}function getOption(e,t){return typeof e[t]=="undefined"?"":e[t]}function setPopupControlsDisabled(e){var t=document.forms[0];t.popupname.disabled=e,t.popupurl.disabled=e,t.popupwidth.disabled=e,t.popupheight.disabled=e,t.popupleft.disabled=e,t.popuptop.disabled=e,t.popuplocation.disabled=e,t.popupscrollbars.disabled=e,t.popupmenubar.disabled=e,t.popupresizable.disabled=e,t.popuptoolbar.disabled=e,t.popupstatus.disabled=e,t.popupreturn.disabled=e,t.popupdependent.disabled=e,setBrowserDisabled("popupurlbrowser",e)}function parseLink(e){var t,n,r,i,s,o,u,a;e=e.replace(RegExp("&#39;","g"),"'"),t=e.replace(RegExp("\\s*([A-Za-z0-9.]*)\\s*\\(.*","gi"),"$1"),n=templates[t];if(n){r=n.match(RegExp("'?\\$\\{[A-Za-z0-9.]*\\}'?","gi")),i="\\s*[A-Za-z0-9.]*\\s*\\(",s="";for(o=0;o<r.length;o++)r[o].indexOf("'${")!=-1?i+="'(.*)'":i+="([0-9]*)",s+="$"+(o+1),r[o]=r[o].replace(RegExp("[^A-Za-z0-9]","gi"),""),o!=r.length-1?(i+="\\s*,\\s*",s+="<delim>"):i+=".*";i+="\\);?",u=[],u._function=t,a=e.replace(RegExp(i,"gi"),s).split("<delim>");for(o=0;o<r.length;o++)u[r[o]]=a[o];return u}return null}function parseOptions(e){var t,n,r,i;if(e==null||e=="")return[];e=e.toLowerCase(),e=e.replace(/;/g,","),e=e.replace(/[^0-9a-z=,]/g,""),t=e.split(","),n=[];for(r=0;r<t.length;r++)i=t[r].split("="),i.length==2&&(n[i[0]]=i[1]);return n}function buildOnClick(){var e,t,n=document.forms[0];if(!n.ispopup.checked){n.onclick.value="";return}e="window.open('",t=n.popupurl.value,e+=t+"','",e+=n.popupname.value+"','",n.popuplocation.checked&&(e+="location=yes,"),n.popupscrollbars.checked&&(e+="scrollbars=yes,"),n.popupmenubar.checked&&(e+="menubar=yes,"),n.popupresizable.checked&&(e+="resizable=yes,"),n.popuptoolbar.checked&&(e+="toolbar=yes,"),n.popupstatus.checked&&(e+="status=yes,"),n.popupdependent.checked&&(e+="dependent=yes,"),n.popupwidth.value!=""&&(e+="width="+n.popupwidth.value+","),n.popupheight.value!=""&&(e+="height="+n.popupheight.value+","),n.popupleft.value!=""&&(n.popupleft.value!="c"?e+="left="+n.popupleft.value+",":e+="left='+(screen.availWidth/2-"+n.popupwidth.value/2+")+',"),n.popuptop.value!=""&&(n.popuptop.value!="c"?e+="top="+n.popuptop.value+",":e+="top='+(screen.availHeight/2-"+n.popupheight.value/2+")+',"),e.charAt(e.length-1)==","&&(e=e.substring(0,e.length-1)),e+="');",n.popupreturn.checked&&(e+="return false;"),n.onclick.value=e,n.href.value==""&&(n.href.value=t)}function setAttrib(e,t,n){var r=document.forms[0],i=r.elements[t.toLowerCase()],s=tinyMCEPopup.editor.dom;if(typeof n=="undefined"||n==null)n="",i&&(n=i.value);t=="style"&&(n=s.serializeStyle(s.parseStyle(n),"a")),s.setAttrib(e,t,n)}function getAnchorListHTML(e,t){var n,r,i,s=tinyMCEPopup.editor,o=s.dom.select("a"),u="";for(r=0,i=o.length;r<i;r++)(n=s.dom.getAttrib(o[r],"name"))!=""&&(u+='<option value="#'+n+'">'+n+"</option>");return u==""?"":(u='<select id="'+e+'" name="'+e+'" class="mceAnchorList"'+' onchange="this.form.'+t+'.value=this.options[this.selectedIndex].value"'+">"+'<option value="">---</option>'+u+"</select>",u)}function insertAction(){var e,t,n=tinyMCEPopup.editor,r=n.selection.getNode();checkPrefix(document.forms[0].href),r=n.dom.getParent(r,"A");if(!document.forms[0].href.value){t=n.selection.getBookmark(),n.dom.remove(r,1),n.selection.moveToBookmark(t),tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close();return}if(r==null){n.getDoc().execCommand("unlink",!1,null),tinyMCEPopup.execCommand("mceInsertLink",!1,"#mce_temp_url#",{skip_undo:1}),e=tinymce.grep(n.dom.select("a"),function(e){return n.dom.getAttrib(e,"href")=="#mce_temp_url#"});for(t=0;t<e.length;t++)setAllAttribs(r=e[t])}else setAllAttribs(r);if(r.childNodes.length!=1||r.firstChild.nodeName!="IMG")n.focus(),n.selection.select(r),n.selection.collapse(0),tinyMCEPopup.storeSelection();tinyMCEPopup.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function setAllAttribs(e){var t=document.forms[0],n=t.href.value.replace(/ /g,"%20"),r=getSelectValue(t,"targetlist");setAttrib(e,"href",n),setAttrib(e,"title"),setAttrib(e,"target",r=="_self"?"":r),setAttrib(e,"id"),setAttrib(e,"style"),setAttrib(e,"class",getSelectValue(t,"classlist")),setAttrib(e,"rel"),setAttrib(e,"rev"),setAttrib(e,"charset"),setAttrib(e,"hreflang"),setAttrib(e,"dir"),setAttrib(e,"lang"),setAttrib(e,"tabindex"),setAttrib(e,"accesskey"),setAttrib(e,"type"),setAttrib(e,"onfocus"),setAttrib(e,"onblur"),setAttrib(e,"onclick"),setAttrib(e,"ondblclick"),setAttrib(e,"onmousedown"),setAttrib(e,"onmouseup"),setAttrib(e,"onmouseover"),setAttrib(e,"onmousemove"),setAttrib(e,"onmouseout"),setAttrib(e,"onkeypress"),setAttrib(e,"onkeydown"),setAttrib(e,"onkeyup"),tinyMCE.isMSIE5&&(e.outerHTML=e.outerHTML)}function getSelectValue(e,t){var n=e.elements[t];return!n||n.options==null||n.selectedIndex==-1?"":n.options[n.selectedIndex].value}function getLinkListHTML(e,t,n){var r,i;if(typeof tinyMCELinkList=="undefined"||tinyMCELinkList.length==0)return"";r="",r+='<select id="'+e+'" name="'+e+'"',r+=' class="mceLinkList" onfoc2us="tinyMCE.addSelectAccessibility(event, this, window);" onchange="this.form.'+t+".value=",r+="this.options[this.selectedIndex].value;",typeof n!="undefined"&&(r+=n+"('"+t+"',this.options[this.selectedIndex].text,this.options[this.selectedIndex].value);"),r+='"><option value="">---</option>';for(i=0;i<tinyMCELinkList.length;i++)r+='<option value="'+tinyMCELinkList[i][1]+'">'+tinyMCELinkList[i][0]+"</option>";return r+="</select>",r}function getTargetListHTML(e,t){var n,r,i,s=tinyMCEPopup.getParam("theme_advanced_link_targets","").split(";"),o="";o+='<select id="'+e+'" name="'+e+'" onfocus="tinyMCE.addSelectAccessibility(event, this, window);" onchange="this.form.'+t+".value=",o+='this.options[this.selectedIndex].value;">',o+='<option value="_self">'+tinyMCEPopup.getLang("advlink_dlg.target_same")+"</option>",o+='<option value="_blank">'+tinyMCEPopup.getLang("advlink_dlg.target_blank")+" (_blank)</option>",o+='<option value="_parent">'+tinyMCEPopup.getLang("advlink_dlg.target_parent")+" (_parent)</option>",o+='<option value="_top">'+tinyMCEPopup.getLang("advlink_dlg.target_top")+" (_top)</option>";for(n=0;n<s.length;n++){if(s[n]=="")continue;r=s[n].split("=")[0],i=s[n].split("=")[1],o+='<option value="'+r+'">'+i+" ("+r+")</option>"}return o+="</select>",o}var templates;tinyMCEPopup.requireLangPack(),templates={"window.open":"window.open('${url}','${target}','${options}')"},preinit(),tinyMCEPopup.onInit.add(init);