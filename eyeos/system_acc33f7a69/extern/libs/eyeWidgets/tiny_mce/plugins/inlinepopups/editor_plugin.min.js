(function(){var e=tinymce.DOM,t=tinymce.dom.Element,n=tinymce.dom.Event,r=tinymce.each,i=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(t){t.onBeforeRenderUI.add(function(){t.windowManager=new tinymce.InlineWindowManager(t),e.loadCSS("index.php?theme=1&extern=css/tiny_mce/inlinepopup.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(e){var t=this;t.parent(e),t.zIndex=3e5,t.count=0,t.windows={}},open:function(r,i){var s,o,u,a,f,l,c,h=this,p="",d=h.editor,v=0,m=0;return r=r||{},i=i||{},r.inline?(c=h._frontWindow(),c&&e.get(c.id+"_ifr")&&(c.focussedElement=e.get(c.id+"_ifr").contentWindow.document.activeElement),r.type||(h.bookmark=d.selection.getBookmark(1)),s=e.uniqueId(),o=e.getViewPort(),r.width=parseInt(r.width||320),r.height=parseInt(r.height||240)+(tinymce.isIE?8:0),r.min_width=parseInt(r.min_width||150),r.min_height=parseInt(r.min_height||100),r.max_width=parseInt(r.max_width||2e3),r.max_height=parseInt(r.max_height||2e3),r.left=r.left||Math.round(Math.max(o.x,o.x+o.w/2-r.width/2)),r.top=r.top||Math.round(Math.max(o.y,o.y+o.h/2-r.height/2)),r.movable=r.resizable=!0,i.mce_width=r.width,i.mce_height=r.height,i.mce_inline=!0,i.mce_window_id=s,i.mce_auto_focus=r.auto_focus,h.features=r,h.params=i,h.onOpen.dispatch(h,r,i),r.type&&(p+=" mceModal",r.type&&(p+=" mce"+r.type.substring(0,1).toUpperCase()+r.type.substring(1)),r.resizable=!1),r.statusbar&&(p+=" mceStatusbar"),r.resizable&&(p+=" mceResizable"),r.minimizable&&(p+=" mceMinimizable"),r.maximizable&&(p+=" mceMaximizable"),r.movable&&(p+=" mceMovable"),h._addAll(e.doc.body,["div",{id:s,role:"dialog","aria-labelledby":r.type?s+"_content":s+"_title","class":(d.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:s+"_wrapper","class":"mceWrapper"+p},["div",{id:s+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:s+"_title"},r.title||""]],["div",{id:s+"_middle","class":"mceMiddle"},["div",{id:s+"_left","class":"mceLeft",tabindex:"0"}],["span",{id:s+"_content"}],["div",{id:s+"_right","class":"mceRight",tabindex:"0"}]],["div",{id:s+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:s+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:s+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:s+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:s+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:s+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:s+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:s+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:s+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:s+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]),e.setStyles(s,{top:-1e4,left:-1e4}),tinymce.isGecko&&e.setStyle(s,"overflow","auto"),r.type||(v+=e.get(s+"_left").clientWidth,v+=e.get(s+"_right").clientWidth,m+=e.get(s+"_top").clientHeight,m+=e.get(s+"_bottom").clientHeight),e.setStyles(s,{top:r.top,left:r.left,width:r.width+v,height:r.height+m}),l=r.url||r.file,l&&(tinymce.relaxedDomain&&(l+=(l.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),l=tinymce._addVer(l)),r.type?(e.add(s+"_wrapper","a",{id:s+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok"),r.type=="confirm"&&e.add(s+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel"),e.add(s+"_middle","div",{"class":"mceIcon"}),e.setHTML(s+"_content",r.content.replace("\n","<br />")),n.add(s,"keyup",function(e){var t=27;if(e.keyCode===t)return r.button_func(!1),n.cancel(e)}),n.add(s,"keydown",function(t){var r,i=9;if(t.keyCode===i)return r=e.select("a.mceCancel",s+"_wrapper")[0],r&&r!==t.target?r.focus():e.get(s+"_ok").focus(),n.cancel(t)})):(e.add(s+"_content","iframe",{id:s+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),e.setStyles(s+"_ifr",{width:r.width,height:r.height}),e.setAttrib(s+"_ifr","src",l)),u=n.add(s,"mousedown",function(t){var r,i=t.target,o=h.windows[s];h.focus(s);if(i.nodeName=="A"||i.nodeName=="a"){if(i.className=="mceClose")return h.close(null,s),n.cancel(t);if(i.className=="mceMax")o.oldPos=o.element.getXY(),o.oldSize=o.element.getSize(),r=e.getViewPort(),r.w-=2,r.h-=2,o.element.moveTo(r.x,r.y),o.element.resizeTo(r.w,r.h),e.setStyles(s+"_ifr",{width:r.w-o.deltaWidth,height:r.h-o.deltaHeight}),e.addClass(s+"_wrapper","mceMaximized");else if(i.className=="mceMed")o.element.moveTo(o.oldPos.x,o.oldPos.y),o.element.resizeTo(o.oldSize.w,o.oldSize.h),o.iframeElement.resizeTo(o.oldSize.w-o.deltaWidth,o.oldSize.h-o.deltaHeight),e.removeClass(s+"_wrapper","mceMaximized");else{if(i.className=="mceMove")return h._startDrag(s,t,i.className);if(e.hasClass(i,"mceResize"))return h._startDrag(s,t,i.className.substring(13))}}}),a=n.add(s,"click",function(e){var t=e.target;h.focus(s);if(t.nodeName=="A"||t.nodeName=="a")switch(t.className){case"mceClose":return h.close(null,s),n.cancel(e);case"mceButton mceOk":case"mceButton mceCancel":return r.button_func(t.className=="mceButton mceOk"),n.cancel(e)}}),n.add([s+"_left",s+"_right"],"focus",function(t){var n,r,i=e.get(s+"_ifr");i?(n=i.contentWindow.document.body,r=e.select(":input:enabled,*[tabindex=0]",n),t.target.id===s+"_left"?r[r.length-1].focus():r[0].focus()):e.get(s+"_ok").focus()}),f=h.windows[s]={id:s,mousedown_func:u,click_func:a,element:new t(s,{blocker:1,container:d.getContainer()}),iframeElement:new t(s+"_ifr"),features:r,deltaWidth:v,deltaHeight:m},f.iframeElement.on("focus",function(){h.focus(s)}),h.count==0&&h.editor.getParam("dialog_type","modal")=="modal"?(e.add(e.doc.body,"div",{id:"mceModalBlocker","class":(h.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:h.zIndex-1}}),e.show("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","true")):e.setStyle("mceModalBlocker","z-index",h.zIndex-1),(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceModalBlocker",{position:"absolute",left:o.x,top:o.y,width:o.w-2,height:o.h-2}),e.setAttrib(s,"aria-hidden","false"),h.focus(s),h._fixIELayout(s,1),e.get(s+"_ok")&&e.get(s+"_ok").focus(),h.count++,f):h.parent(r,i)},focus:function(t){var n,r=this;if(n=r.windows[t])n.zIndex=this.zIndex++,n.element.setStyle("zIndex",n.zIndex),n.element.update(),t+="_wrapper",e.removeClass(r.lastId,"mceFocus"),e.addClass(t,"mceFocus"),r.lastId=t,n.focussedElement?n.focussedElement.focus():e.get(t+"_ok")?e.get(n.id+"_ok").focus():e.get(n.id+"_ifr")&&e.get(n.id+"_ifr").focus()},_addAll:function(e,t){var n,r=this,s=tinymce.DOM;if(i(t,"string"))e.appendChild(s.doc.createTextNode(t));else if(t.length){e=e.appendChild(s.create(t[0],t[1]));for(n=2;n<t.length;n++)r._addAll(e,t[n])}},_startDrag:function(r,i,s){function k(){if(a)return;w._fixIELayout(r,0),e.add(E.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(w.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:w.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceEventBlocker",{position:"absolute",left:C.x,top:C.y,width:C.w-2,height:C.h-2}),a=new t("mceEventBlocker"),a.update(),f=x.getXY(),l=x.getSize(),h=N.x+f.x-C.x,p=N.y+f.y-C.y,e.add(a.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:h,top:p,width:l.w,height:l.h}}),c=new t("mcePlaceHolder")}var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=this,E=e.doc,S=w.windows[r],x=S.element,T=x.getXY(),N={x:0,y:0},C=e.getViewPort();return C.w-=2,C.h-=2,d=i.screenX,v=i.screenY,m=g=y=b=0,o=n.add(E,"mouseup",function(t){return n.remove(E,"mouseup",o),n.remove(E,"mousemove",u),a&&a.remove(),x.moveBy(m,g),x.resizeBy(y,b),l=x.getSize(),e.setStyles(r+"_ifr",{width:l.w-S.deltaWidth,height:l.h-S.deltaHeight}),w._fixIELayout(r,1),n.cancel(t)}),s!="Move"&&k(),u=n.add(E,"mousemove",function(e){var t,r,i;k(),t=e.screenX-d,r=e.screenY-v;switch(s){case"ResizeW":m=t,y=0-t;break;case"ResizeE":y=t;break;case"ResizeN":case"ResizeNW":case"ResizeNE":s=="ResizeNW"?(m=t,y=0-t):s=="ResizeNE"&&(y=t),g=r,b=0-r;break;case"ResizeS":case"ResizeSW":case"ResizeSE":s=="ResizeSW"?(m=t,y=0-t):s=="ResizeSE"&&(y=t),b=r;break;case"mceMove":m=t,g=r}return y<(i=S.features.min_width-l.w)&&(m!==0&&(m+=y-i),y=i),b<(i=S.features.min_height-l.h)&&(g!==0&&(g+=b-i),b=i),y=Math.min(y,S.features.max_width-l.w),b=Math.min(b,S.features.max_height-l.h),m=Math.max(m,C.x-(h+C.x)),g=Math.max(g,C.y-(p+C.y)),m=Math.min(m,C.w+C.x-(h+l.w+C.x)),g=Math.min(g,C.h+C.y-(p+l.h+C.y)),m+g!==0&&(h+m<0&&(m=0),p+g<0&&(g=0),c.moveTo(h+m,p+g)),y+b!==0&&c.resizeTo(l.w+y,l.h+b),n.cancel(e)}),n.cancel(i)},resizeBy:function(e,t,n){var r=this.windows[n];r&&(r.element.resizeBy(e,t),r.iframeElement.resizeBy(e,t))},close:function(t,r){var i,s,o=this,u=e.doc,r=o._findId(r||t);if(!o.windows[r]){o.parent(t);return}o.count--,o.count==0&&(e.remove("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","false"),o.editor.focus());if(i=o.windows[r])o.onClose.dispatch(o),n.remove(u,"mousedown",i.mousedownFunc),n.remove(u,"click",i.clickFunc),n.clear(r),n.clear(r+"_ifr"),e.setAttrib(r+"_ifr","src",'javascript:""'),i.element.remove(),delete o.windows[r],s=o._frontWindow(),s&&o.focus(s.id)},_frontWindow:function(){var e,t=0;return r(this.windows,function(n){n.zIndex>t&&(e=n,t=n.zIndex)}),e},setTitle:function(t,n){var r;t=this._findId(t);if(r=e.get(t+"_title"))r.innerHTML=e.encode(n)},alert:function(t,n){var r=this,i=r.open({title:r,type:"alert",button_func:function(e){n&&n.call(e||r,e),r.close(null,i.id)},content:e.encode(r.editor.getLang(t,t)),inline:1,width:400,height:130})},confirm:function(t,n){var r=this,i=r.open({title:r,type:"confirm",button_func:function(e){n&&n.call(e||r,e),r.close(null,i.id)},content:e.encode(r.editor.getLang(t,t)),inline:1,width:400,height:130})},_findId:function(t){var n=this;return typeof t=="string"?t:(r(n.windows,function(n){var r=e.get(n.id+"_ifr");if(r&&t==r.contentWindow)return t=n.id,!1}),t)},_fixIELayout:function(t,n){var i,s;if(!tinymce.isIE6)return;r(["n","s","w","e","nw","ne","sw","se"],function(r){var i=e.get(t+"_resize_"+r);e.setStyles(i,{width:n?i.clientWidth:"",height:n?i.clientHeight:"",cursor:e.getStyle(i,"cursor",1)}),e.setStyle(t+"_bottom","bottom","-1px"),i=0});if(i=this.windows[t])i.element.hide(),i.element.show(),r(e.select("div,a",t),function(e){e.currentStyle.backgroundImage!="none"&&(s=new Image,s.src=e.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),e.get(t).style.filter=""}}),tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();