(function(){tinymce.create("tinymce.plugins.AutolinkPlugin",{init:function(e){var t=this;if(tinyMCE.isIE)return;e.onKeyDown.add(function(e,n){if(n.keyCode==13)return t.handleEnter(e)}),e.onKeyPress.add(function(e,n){if(n.which==41)return t.handleEclipse(e)}),e.onKeyUp.add(function(e,n){if(n.keyCode==32)return t.handleSpacebar(e)})},handleEclipse:function(e){this.parseCurrentLine(e,-1,"(",!0)},handleSpacebar:function(e){this.parseCurrentLine(e,0,"",!0)},handleEnter:function(e){this.parseCurrentLine(e,-1,"",!1)},parseCurrentLine:function(e,t,n){var r,i,s,o,u,a,f,l,c,h=e.selection.getRng().cloneRange();if(h.startOffset<5){f=h.endContainer.previousSibling;if(f==null){if(h.endContainer.firstChild==null||h.endContainer.firstChild.nextSibling==null)return;f=h.endContainer.firstChild.nextSibling}l=f.length,h.setStart(f,l),h.setEnd(f,l);if(h.endOffset<5)return;r=h.endOffset,s=f}else{s=h.endContainer;if(s.nodeType!=3&&s.firstChild){while(s.nodeType!=3&&s.firstChild)s=s.firstChild;h.setStart(s,0),h.setEnd(s,s.nodeValue.length)}h.endOffset==1?r=2:r=h.endOffset-1-t}i=r;do h.setStart(s,r-2),h.setEnd(s,r-1),r-=1;while(h+""!=" "&&h+""!=""&&(h+"").charCodeAt(0)!=160&&r-2>=0&&h+""!=n);h+""==n||(h+"").charCodeAt(0)==160?(h.setStart(s,r),h.setEnd(s,i),r+=1):h.startOffset==0?(h.setStart(s,0),h.setEnd(s,i)):(h.setStart(s,r),h.setEnd(s,i)),u=h+"",a=u.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)(.+)$/i),a&&(a[1]=="www."&&(a[1]="http://www."),o=e.selection.getBookmark(),e.selection.setRng(h),tinyMCE.execCommand("createlink",!1,a[1]+a[2]),e.selection.moveToBookmark(o),tinyMCE.isWebKit&&(e.selection.collapse(!1),c=Math.min(s.length,i+1),h.setStart(s,c),h.setEnd(s,c),e.selection.setRng(h)))},getInfo:function(){return{longname:"Autolink",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autolink",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("autolink",tinymce.plugins.AutolinkPlugin)})();