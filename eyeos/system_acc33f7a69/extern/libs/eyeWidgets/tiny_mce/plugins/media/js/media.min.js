(function(){function t(e){return document.getElementById(e)}function n(e){var t,r,i,s;if(null==e||"object"!=typeof e)return e;if("length"in e){i=[];for(t=0,r=e.length;t<r;++t)i[t]=n(e[t]);return i}i={};for(s in e)e.hasOwnProperty(s)&&(i[s]=n(e[s]));return i}function r(e){var n=t(e);return n.nodeName=="SELECT"?n.options[n.selectedIndex].value:n.type=="checkbox"?n.checked:n.value}function i(e,n,r){var i;typeof n!="undefined"&&n!=null&&(i=t(e),i.nodeName=="SELECT"?selectByValue(document.forms[0],e,n):i.type=="checkbox"?(typeof n=="string"&&(n=n.toLowerCase(),n=!r&&n==="true"||r&&n===r.toLowerCase()),i.checked=!!n):i.value=n)}var e;(e=tinyMCEPopup.getParam("media_external_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>'),window.Media={init:function(){var e,r,i=this;i.editor=r=tinyMCEPopup.editor,t("filebrowsercontainer").innerHTML=getBrowserHTML("filebrowser","src","media","media"),t("qtsrcfilebrowsercontainer").innerHTML=getBrowserHTML("qtsrcfilebrowser","quicktime_qtsrc","media","media"),t("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),t("video_altsource1_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource1","video_altsource1","media","media"),t("video_altsource2_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource2","video_altsource2","media","media"),t("audio_altsource1_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource1","audio_altsource1","media","media"),t("audio_altsource2_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource2","audio_altsource2","media","media"),t("video_poster_filebrowser").innerHTML=getBrowserHTML("filebrowser_poster","video_poster","media","image"),e=i.getMediaListHTML("medialist","src","media","media"),e==""?t("linklistrow").style.display="none":t("linklistcontainer").innerHTML=e,isVisible("filebrowser")&&(t("src").style.width="230px"),isVisible("video_filebrowser_altsource1")&&(t("video_altsource1").style.width="220px"),isVisible("video_filebrowser_altsource2")&&(t("video_altsource2").style.width="220px"),isVisible("audio_filebrowser_altsource1")&&(t("audio_altsource1").style.width="220px"),isVisible("audio_filebrowser_altsource2")&&(t("audio_altsource2").style.width="220px"),isVisible("filebrowser_poster")&&(t("video_poster").style.width="220px"),r.dom.setOuterHTML(t("media_type"),i.getMediaTypeHTML(r)),i.setDefaultDialogSettings(r),i.data=n(tinyMCEPopup.getWindowArg("data")),i.dataToForm(),i.preview(),updateColor("bgcolor_pick","bgcolor")},insert:function(){var e=tinyMCEPopup.editor;this.formToData(),e.execCommand("mceRepaint"),tinyMCEPopup.restoreSelection(),e.selection.setNode(e.plugins.media.dataToImg(this.data)),tinyMCEPopup.close()},preview:function(){t("prev").innerHTML=this.editor.plugins.media.dataToHtml(this.data,!0)},moveStates:function(e,n){function h(e){var t={};return e&&tinymce.each(e.split("&"),function(e){var n=e.split("=");t[unescape(n[0])]=unescape(n[1])}),t}function p(t,n){var s,o,u,f,l;if(t==a.type||t=="global"){n=tinymce.explode(n);for(s=0;s<n.length;s++)o=n[s],u=t=="global"?o:t+"_"+o,t=="global"?l=a:t=="video"||t=="audio"?(l=a.video.attrs,!l&&!e&&(a.video.attrs=l={})):l=a.params,l&&(e?i(u,l[o],t=="video"||t=="audio"?o:""):(delete l[o],f=r(u),(t=="video"||t=="audio")&&f===!0&&(f=o),c[u]?f!==c[u]&&(f=""+f,l[o]=f):f&&(f=""+f,l[o]=f)))}}var s,o,u,a=this.data,f=this.editor,l=f.plugins.media,c={quicktime_autoplay:!0,quicktime_controller:!0,flash_play:!0,flash_loop:!0,flash_menu:!0,windowsmedia_autostart:!0,windowsmedia_enablecontextmenu:!0,windowsmedia_invokeurls:!0,realmedia_autogotourl:!0,realmedia_imagestatus:!0};if(!e){a.type=t("media_type").options[t("media_type").selectedIndex].value,a.width=r("width"),a.height=r("height"),o=r("src");if(n=="src"){s=o.replace(/^.*\.([^.]+)$/,"$1");if(u=l.getType(s))a.type=u.name.toLowerCase();i("media_type",a.type)}if(a.type=="video"||a.type=="audio")a.video.sources||(a.video.sources=[]),a.video.sources[0]={src:r("src")}}t("video_options").style.display="none",t("audio_options").style.display="none",t("flash_options").style.display="none",t("quicktime_options").style.display="none",t("shockwave_options").style.display="none",t("windowsmedia_options").style.display="none",t("realmedia_options").style.display="none",t("embeddedaudio_options").style.display="none",t(a.type+"_options")&&(t(a.type+"_options").style.display="block"),i("media_type",a.type),p("flash","play,loop,menu,swliveconnect,quality,scale,salign,wmode,base,flashvars"),p("quicktime","loop,autoplay,cache,controller,correction,enablejavascript,kioskmode,autohref,playeveryframe,targetcache,scale,starttime,endtime,target,qtsrcchokespeed,volume,qtsrc"),p("shockwave","sound,progress,autostart,swliveconnect,swvolume,swstretchstyle,swstretchhalign,swstretchvalign"),p("windowsmedia","autostart,enabled,enablecontextmenu,fullscreen,invokeurls,mute,stretchtofit,windowlessvideo,balance,baseurl,captioningid,currentmarker,currentposition,defaultframe,playcount,rate,uimode,volume"),p("realmedia","autostart,loop,autogotourl,center,imagestatus,maintainaspect,nojava,prefetch,shuffle,console,controls,numloop,scriptcallbacks"),p("video","poster,autoplay,loop,muted,preload,controls"),p("audio","autoplay,loop,preload,controls"),p("embeddedaudio","autoplay,loop,controls"),p("global","id,name,vspace,hspace,bgcolor,align,width,height"),e?a.type=="video"?(a.video.sources[0]&&i("src",a.video.sources[0].src),o=a.video.sources[1],o&&i("video_altsource1",o.src),o=a.video.sources[2],o&&i("video_altsource2",o.src)):a.type=="audio"?(a.video.sources[0]&&i("src",a.video.sources[0].src),o=a.video.sources[1],o&&i("audio_altsource1",o.src),o=a.video.sources[2],o&&i("audio_altsource2",o.src)):(a.type=="flash"&&tinymce.each(f.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),function(e,t){e=="$url"&&(a.params.src=h(a.params.flashvars)[t]||a.params.src||"")}),i("src",a.params.src)):(o=r("src"),o.match(/youtu.be\/[a-z1-9.-_]+/)&&(a.width=425,a.height=350,a.params.frameborder="0",a.type="iframe",o="http://www.youtube.com/embed/"+o.match(/youtu.be\/([a-z1-9.-_]+)/)[1],i("src",o),i("media_type",a.type)),o.match(/youtube.com(.+)v=([^&]+)/)&&(a.width=425,a.height=350,a.params.frameborder="0",a.type="iframe",o="http://www.youtube.com/embed/"+o.match(/v=([^&]+)/)[1],i("src",o),i("media_type",a.type)),o.match(/video.google.com(.+)docid=([^&]+)/)&&(a.width=425,a.height=326,a.type="flash",o="http://video.google.com/googleplayer.swf?docId="+o.match(/docid=([^&]+)/)[1]+"&hl=en",i("src",o),i("media_type",a.type)),a.type=="video"?(a.video.sources||(a.video.sources=[]),a.video.sources[0]={src:o},o=r("video_altsource1"),o&&(a.video.sources[1]={src:o}),o=r("video_altsource2"),o&&(a.video.sources[2]={src:o})):a.type=="audio"?(a.video.sources||(a.video.sources=[]),a.video.sources[0]={src:o},o=r("audio_altsource1"),o&&(a.video.sources[1]={src:o}),o=r("audio_altsource2"),o&&(a.video.sources[2]={src:o})):a.params.src=o,i("width",a.width||(a.type=="audio"?300:320)),i("height",a.height||(a.type=="audio"?32:240)))},dataToForm:function(){this.moveStates(!0)},formToData:function(e){(e=="width"||e=="height")&&this.changeSize(e),e=="source"?(this.moveStates(!1,e),i("source",this.editor.plugins.media.dataToHtml(this.data)),this.panel="source"):(this.panel=="source"&&(this.data=n(this.editor.plugins.media.htmlToData(r("source"))),this.dataToForm(),this.panel=""),this.moveStates(!1,e),this.preview())},beforeResize:function(){this.width=parseInt(r("width")||(this.data.type=="audio"?"300":"320"),10),this.height=parseInt(r("height")||(this.data.type=="audio"?"32":"240"),10)},changeSize:function(e){var n,s;t("constrain").checked&&(n=parseInt(r("width")||(this.data.type=="audio"?"300":"320"),10),s=parseInt(r("height")||(this.data.type=="audio"?"32":"240"),10),e=="width"?(this.height=Math.round(n/this.width*s),i("height",this.height)):(this.width=Math.round(s/this.height*n),i("width",this.width)))},getMediaListHTML:function(){var e,t;if(typeof tinyMCEMediaList!="undefined"&&tinyMCEMediaList.length>0){e="",e+='<select id="linklist" name="linklist" style="width: 250px" onchange="this.form.src.value=this.options[this.selectedIndex].value;Media.formToData(\'src\');">',e+='<option value="">---</option>';for(t=0;t<tinyMCEMediaList.length;t++)e+='<option value="'+tinyMCEMediaList[t][1]+'">'+tinyMCEMediaList[t][0]+"</option>";return e+="</select>",e}return""},getMediaTypeHTML:function(e){function n(t,n){return e.schema.getElementRule(n||t)?'<option value="'+t+'">'+tinyMCEPopup.editor.translate("media_dlg."+t)+"</option>":""}var t;return t="",t+='<select id="media_type" name="media_type" onchange="Media.formToData(\'type\');">',t+=n("video"),t+=n("audio"),t+=n("flash","object"),t+=n("quicktime","object"),t+=n("shockwave","object"),t+=n("windowsmedia","object"),t+=n("realmedia","object"),t+=n("iframe"),e.getParam("media_embedded_audio",!1)&&(t+=n("embeddedaudio","object")),t+="</select>",t},setDefaultDialogSettings:function(e){var t=e.getParam("media_dialog_defaults",{});tinymce.each(t,function(e,t){i(t,e)})}},tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(function(){Media.init()})})();