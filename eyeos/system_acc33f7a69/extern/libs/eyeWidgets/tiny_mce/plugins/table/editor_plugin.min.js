(function(e){function n(e,t){var n,r=t.ownerDocument,i=r.createRange();return i.setStartBefore(t),i.setEnd(e.endContainer,e.endOffset),n=r.createElement("body"),n.appendChild(i.cloneContents()),n.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function r(e,t){return parseInt(e.getAttribute(t)||1)}function s(n,s,o){function c(e,t){return e=e.cloneNode(t),e.removeAttribute("id"),e}function h(){var e=0;u=[],t(["thead","tbody","tfoot"],function(i){var o=s.select("> "+i+" tr",n);t(o,function(n,o){o+=e,t(s.select("> td, > th",n),function(e,t){var n,s,a,f;if(u[o])while(u[o][t])t++;a=r(e,"rowspan"),f=r(e,"colspan");for(s=o;s<o+a;s++){u[s]||(u[s]=[]);for(n=t;n<t+f;n++)u[s][n]={part:i,real:s==o&&n==t,elm:e,rowspan:a,colspan:f}}})}),e+=o.length})}function p(e,t){var n=u[t];if(n)return n[e]}function d(e,t,n){e&&(n=parseInt(n),n===1?e.removeAttribute(t,1):e.setAttribute(t,n,1))}function v(e){return e&&(s.hasClass(e.elm,"mceSelected")||e==l)}function m(){var e=[];return t(n.rows,function(n){t(n.cells,function(t){if(s.hasClass(t,"mceSelected")||t==l.elm)return e.push(n),!1})}),e}function g(){var e=s.createRng();e.setStartAfter(n),e.setEndAfter(n),o.setRng(e),s.remove(n)}function b(n){var r;return e.walk(n,function(i){var o;if(i.nodeType==3)return t(s.getParents(i.parentNode,null,n).reverse(),function(e){e=c(e,!1),r?o&&o.appendChild(e):r=o=e,o=e}),o&&(o.innerHTML=e.isIE?"&nbsp;":'<br data-mce-bogus="1" />'),!1},"childNodes"),n=c(n,!1),d(n,"rowSpan",1),d(n,"colSpan",1),r?n.appendChild(r):e.isIE||(n.innerHTML='<br data-mce-bogus="1" />'),n}function w(){var e=s.createRng();t(s.select("tr",n),function(e){e.cells.length==0&&s.remove(e)});if(s.select("tr",n).length==0){e.setStartAfter(n),e.setEndAfter(n),o.setRng(e),s.remove(n);return}t(s.select("thead,tbody,tfoot",n),function(e){e.rows.length==0&&s.remove(e)}),h(),row=u[Math.min(u.length-1,a.y)],row&&(o.select(row[Math.min(row.length-1,a.x)].elm,!0),o.collapse(!0))}function E(e,t,n,r){var i,o,a,f,l=u[t][e].elm.parentNode;for(o=1;o<=n;o++){l=s.getNext(l,"tr");if(l){for(i=e;i>=0;i--){f=u[t+o][i].elm;if(f.parentNode==l){for(a=1;a<=r;a++)s.insertAfter(b(f),f);break}}if(i==-1)for(a=1;a<=r;a++)l.insertBefore(b(l.cells[0]),l.cells[0])}}}function S(){t(u,function(e,n){t(e,function(e,t){var i,o,u;if(v(e)){e=e.elm,i=r(e,"colspan"),o=r(e,"rowspan");if(i>1||o>1){d(e,"rowSpan",1),d(e,"colSpan",1);for(u=0;u<i-1;u++)s.insertAfter(b(e),e);E(t,n,o-1,i)}}})})}function T(n,r,i){var n,o,l,c,v,m,g,y,b,E,x;n?(pos=_(n),o=pos.x,l=pos.y,c=o+(r-1),v=l+(i-1)):(o=a.x,l=a.y,c=f.x,v=f.y),y=p(o,l),b=p(c,v);if(y&&b&&y.part==b.part){S(),h(),y=p(o,l).elm,d(y,"colSpan",c-o+1),d(y,"rowSpan",v-l+1);for(g=l;g<=v;g++)for(m=o;m<=c;m++){if(!u[g]||!u[g][m])continue;n=u[g][m].elm,n!=y&&(E=e.grep(n.childNodes),t(E,function(e){y.appendChild(e)}),E.length&&(E=e.grep(y.childNodes),x=0,t(E,function(e){e.nodeName=="BR"&&s.getAttrib(e,"data-mce-bogus")&&x++<E.length-1&&y.removeChild(e)})),s.remove(n))}w()}}function N(e){var n,i,o,a,f,l,h,p,m;t(u,function(r,i){t(r,function(t){if(v(t)){t=t.elm,f=t.parentNode,l=c(f,!1),n=i;if(e)return!1}});if(e)return!n});for(a=0;a<u[0].length;a++){if(!u[n][a])continue;i=u[n][a].elm;if(i!=o){if(!e){m=r(i,"rowspan");if(m>1){d(i,"rowSpan",m+1);continue}}else if(n>0&&u[n-1][a]){p=u[n-1][a].elm,m=r(p,"rowSpan");if(m>1){d(p,"rowSpan",m+1);continue}}h=b(i),d(h,"colSpan",i.colSpan),l.appendChild(h),o=i}}l.hasChildNodes()&&(e?f.parentNode.insertBefore(l,f):s.insertAfter(l,f))}function C(e){var n,i;t(u,function(r){t(r,function(t,r){if(v(t)){n=r;if(e)return!1}});if(e)return!n}),t(u,function(t,o){var u,a,f;if(!t[n])return;u=t[n].elm,u!=i&&(f=r(u,"colspan"),a=r(u,"rowspan"),f==1?e?(u.parentNode.insertBefore(b(u),u),E(n,o,a-1,f)):(s.insertAfter(b(u),u),E(n,o,a-1,f)):d(u,"colSpan",u.colSpan+1),i=u)})}function k(){var n=[];t(u,function(i){t(i,function(i,o){v(i)&&e.inArray(n,o)===-1&&(t(u,function(e){var t=e[o].elm,n=r(t,"colSpan");n>1?d(t,"colSpan",n-1):s.remove(t)}),n.push(o))})}),w()}function L(){function n(e){var n,i,o=s.getNext(e,"tr");t(e.cells,function(e){var t=r(e,"rowSpan");t>1&&(d(e,"rowSpan",t-1),n=_(e),E(n.x,n.y,1,1))}),n=_(e.cells[0]),t(u[n.y],function(e){var t;e=e.elm,e!=i&&(t=r(e,"rowSpan"),t>1?d(e,"rowSpan",t-1):s.remove(e),i=e)})}var e;e=m(),t(e.reverse(),function(e){n(e)}),w()}function A(){var e=m();return s.remove(e),w(),e}function O(){var e=m();return t(e,function(t,n){e[n]=c(t,!0)}),e}function M(e,n){var r=m(),o=r[n?0:r.length-1],a=o.cells.length;t(u,function(e){var n;a=0,t(e,function(e){e.real&&(a+=e.colspan),e.elm.parentNode==o&&(n=1)});if(n)return!1}),n||e.reverse(),t(e,function(e){var t,r=e.cells.length;for(i=0;i<r;i++)t=e.cells[i],d(t,"colSpan",1),d(t,"rowSpan",1);for(i=r;i<a;i++)e.appendChild(b(e.cells[r-1]));for(i=a;i<r;i++)s.remove(e.cells[i]);n?o.parentNode.insertBefore(e,o):s.insertAfter(e,o)})}function _(e){var n;return t(u,function(r,i){return t(r,function(t,r){if(t.elm==e)return n={x:r,y:i},!1}),!n}),n}function D(e){a=_(e)}function P(){var e,n=e=0;return t(u,function(r,i){t(r,function(t,r){var s,o;v(t)&&(t=u[i][r],r>n&&(n=r),i>e&&(e=i),t.real&&(s=t.colspan-1,o=t.rowspan-1,s&&r+s>n&&(n=r+s),o&&i+o>e&&(e=i+o)))})}),{x:n,y:e}}function H(e){var t,n,r,i,o,l,c,h;f=_(e);if(a&&f){t=Math.min(a.x,f.x),n=Math.min(a.y,f.y),r=Math.max(a.x,f.x),i=Math.max(a.y,f.y),o=r,l=i;for(y=n;y<=l;y++)e=u[y][t],e.real||t-(e.colspan-1)<t&&(t-=e.colspan-1);for(x=t;x<=o;x++)e=u[n][x],e.real||n-(e.rowspan-1)<n&&(n-=e.rowspan-1);for(y=n;y<=i;y++)for(x=t;x<=r;x++)e=u[y][x],e.real&&(c=e.colspan-1,h=e.rowspan-1,c&&x+c>o&&(o=x+c),h&&y+h>l&&(l=y+h));s.removeClass(s.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=n;y<=l;y++)for(x=t;x<=o;x++)u[y][x]&&s.addClass(u[y][x].elm,"mceSelected")}}var u,a,f,l;h(),l=s.getParent(o.getStart(),"th,td"),l&&(a=_(l),f=P(),l=p(a.x,a.y)),e.extend(this,{deleteTable:g,split:S,merge:T,insertRow:N,insertCol:C,deleteCols:k,deleteRows:L,cutRows:A,copyRows:O,pasteRows:M,getPos:_,setStartCell:D,setEndCell:H})}var t=e.each;e.create("tinymce.plugins.TablePlugin",{init:function(i,o){function l(e){var t=i.selection,n=i.dom.getParent(e||t.getNode(),"table");if(n)return new s(n,i.dom,t)}function c(){i.getBody().style.webkitUserSelect="",f&&(i.dom.removeClass(i.dom.select("td.mceSelected,th.mceSelected"),"mceSelected"),f=!1)}var u,a,f=!0;t([["table","table.desc","mceInsertTable",!0],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",!0],["cell_props","table.cell_desc","mceTableCellProps",!0],["split_cells","table.split_cells_desc","mceTableSplitCells",!0],["merge_cells","table.merge_cells_desc","mceTableMergeCells",!0]],function(e){i.addButton(e[0],{title:e[1],cmd:e[2],ui:e[3]})}),e.isIE||i.onClick.add(function(e,t){t=t.target,t.nodeName==="TABLE"&&(e.selection.select(t),e.nodeChanged())}),i.onPreProcess.add(function(e,t){var n,r,i=e.dom,s=i.select("table",t.node),o=s.length;while(o--){n=s[o],i.setAttrib(n,"data-mce-style","");if(r=i.getAttrib(n,"width"))i.setStyle(n,"width",r),i.setAttrib(n,"width","");if(r=i.getAttrib(n,"height"))i.setStyle(n,"height",r),i.setAttrib(n,"height","")}}),i.onNodeChange.add(function(e,t,n){var r;n=e.selection.getStart(),r=e.dom.getParent(n,"td,th,caption"),t.setActive("table",n.nodeName==="TABLE"||!!r),r&&r.nodeName==="CAPTION"&&(r=0),t.setDisabled("delete_table",!r),t.setDisabled("delete_col",!r),t.setDisabled("delete_table",!r),t.setDisabled("delete_row",!r),t.setDisabled("col_after",!r),t.setDisabled("col_before",!r),t.setDisabled("row_after",!r),t.setDisabled("row_before",!r),t.setDisabled("row_props",!r),t.setDisabled("cell_props",!r),t.setDisabled("split_cells",!r),t.setDisabled("merge_cells",!r)}),i.onInit.add(function(i){function d(e,t,n,r){var i,s,o,u=3,a=e.dom.getParent(t.startContainer,"TABLE");return a&&(i=a.parentNode),s=t.startContainer.nodeType==u&&t.startOffset==0&&t.endOffset==0&&r&&(n.nodeName=="TR"||n==i),o=(n.nodeName=="TD"||n.nodeName=="TH")&&!r,s||o}function v(t){var n,r,i,s;if(!e.isWebKit)return;n=t.selection.getRng(),r=t.selection.getNode(),i=t.dom.getParent(n.startContainer,"TD,TH");if(!d(t,n,r,i))return;i||(i=r),s=i.lastChild;while(s.lastChild)s=s.lastChild;n.setEnd(s,s.nodeValue.length),t.selection.setRng(n)}var s,o,h,p=i.dom;u=i.windowManager,i.onMouseDown.add(function(e,t){t.button!=2&&(c(),o=p.getParent(t.target,"td,th"),s=p.getParent(o,"table"))}),p.bind(i.getDoc(),"mouseover",function(e){var t,n,r=e.target;if(o&&(h||r!=o)&&(r.nodeName=="TD"||r.nodeName=="TH")){n=p.getParent(r,"table"),n==s&&(h||(h=l(n),h.setStartCell(o),i.getBody().style.webkitUserSelect="none"),h.setEndCell(r),f=!0),t=i.selection.getSel();try{t.removeAllRanges?t.removeAllRanges():t.empty()}catch(u){}e.preventDefault()}}),i.onMouseUp.add(function(t){var n,r,i,u,a,f,l=t.selection,c=l.getSel();if(o){h&&(t.getBody().style.webkitUserSelect="");function d(t,r){var i=new e.dom.TreeWalker(t,t);do{if(t.nodeType==3&&e.trim(t.nodeValue).length!=0){r?n.setStart(t,0):n.setEnd(t,t.nodeValue.length);return}if(t.nodeName=="BR"){r?n.setStartBefore(t):n.setEndBefore(t);return}}while(t=r?i.next():i.prev())}r=p.select("td.mceSelected,th.mceSelected");if(r.length>0){n=p.createRng(),u=r[0],f=r[r.length-1],n.setStartBefore(u),n.setEndAfter(u),d(u,1),i=new e.dom.TreeWalker(u,p.getParent(r[0],"table"));do if(u.nodeName=="TD"||u.nodeName=="TH"){if(!p.hasClass(u,"mceSelected"))break;a=u}while(u=i.next());d(a),l.setRng(n)}t.nodeChanged(),o=h=s=null}}),i.onKeyUp.add(function(){c()}),i.onKeyDown.add(function(e){v(e)}),i.onMouseDown.add(function(e,t){t.button!=2&&v(e)}),i.plugins.table.fixTableCellSelection=v,i&&i.plugins.contextmenu&&i.plugins.contextmenu.onContextMenu.add(function(e,t,n){var r,s=i.selection,o=s.getNode()||i.getBody();i.dom.getParent(n,"td")||i.dom.getParent(n,"th")||i.dom.select("td.mceSelected,th.mceSelected").length?(t.removeAll(),o.nodeName=="A"&&!i.dom.getAttrib(o,"name")&&(t.add({title:"advanced.link_desc",icon:"link",cmd:i.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),t.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"}),t.addSeparator()),o.nodeName=="IMG"&&o.className.indexOf("mceItem")==-1&&(t.add({title:"advanced.image_desc",icon:"image",cmd:i.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),t.addSeparator()),t.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}}),t.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"}),t.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"}),t.addSeparator(),r=t.addMenu({title:"table.cell"}),r.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"}),r.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"}),r.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"}),r=t.addMenu({title:"table.row"}),r.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"}),r.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"}),r.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"}),r.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"}),r.addSeparator(),r.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"}),r.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"}),r.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!a),r.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!a),r=t.addMenu({title:"table.col"}),r.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"}),r.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"}),r.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})):t.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})});if(e.isWebKit){function m(n,i){function a(t,r,i){var s,o,u,a,l=t?"previousSibling":"nextSibling",p=n.dom.getParent(r,"tr"),d=p[l];if(d)return b(n,r,d,t),e.dom.Event.cancel(i),!0;s=n.dom.getParent(p,"table"),o=p.parentNode,u=o.nodeName.toLowerCase();if(u==="tbody"||u===(t?"tfoot":"thead")){a=f(t,s,o,"tbody");if(a!==null)return c(t,a,r,i)}return h(t,p,l,s,i)}function f(e,t,r,i){var s,o=n.dom.select(">"+i,t),u=o.indexOf(r);return e&&u===0||!e&&u===o.length-1?l(e,t):u===-1?(s=r.tagName.toLowerCase()==="thead"?0:o.length-1,o[s]):o[u+(e?-1:1)]}function l(e,t){var r=e?"thead":"tfoot",i=n.dom.select(">"+r,t);return i.length!==0?i[0]:null}function c(t,r,i,s){var o=p(r,t);return o&&b(n,i,o,t),e.dom.Event.cancel(s),!0}function h(t,r,i,s,o){var u,f,l=s[i];return l?(d(l),!0):(u=n.dom.getParent(s,"td,th"),u?a(t,u,o):(f=p(r,!t),d(f),e.dom.Event.cancel(o)))}function p(e,t){return e&&e[t?"lastChild":"firstChild"]}function d(e){n.selection.setCursorLocation(e,0)}function v(){return u==o.UP||u==o.DOWN}function m(e){var t=e.selection.getNode(),n=e.dom.getParent(t,"tr");return n!==null}function g(e){var t=0,n=e;while(n.previousSibling)n=n.previousSibling,t+=r(n,"colspan");return t}function y(e,n){var i=0,s=0;return t(e.children,function(e,t){i+=r(e,"colspan"),s=t;if(i>n)return!1}),s}function b(e,t,n,r){var i=g(e.dom.getParent(t,"td,th")),s=y(n,i),o=n.childNodes[s],u=p(o,r);d(u||o)}function w(e){var t=n.selection.getNode(),r=n.dom.getParent(t,"td,th"),i=n.dom.getParent(e,"td,th");return r&&r!==i&&E(r,i)}function E(e,t){return n.dom.getParent(e,"TABLE")===n.dom.getParent(t,"TABLE")}var s,o=e.VK,u=i.keyCode;v()&&m(n)&&(s=n.selection.getNode(),setTimeout(function(){w(s)&&a(!i.shiftKey&&u===o.UP,s,i)},0))}i.onKeyDown.add(m)}if(!e.isIE){function g(){var e;for(e=i.getBody().lastChild;e&&e.nodeType==3&&!e.nodeValue.length;e=e.previousSibling);e&&e.nodeName=="TABLE"&&i.dom.add(i.getBody(),"p",null,'<br mce_bogus="1" />')}e.isGecko&&i.onKeyDown.add(function(e,t){var r,i,s=e.dom;if(t.keyCode==37||t.keyCode==38)r=e.selection.getRng(),i=s.getParent(r.startContainer,"table"),i&&e.getBody().firstChild==i&&n(r,i)&&(r=s.createRng(),r.setStartBefore(i),r.setEndBefore(i),e.selection.setRng(r),t.preventDefault())}),i.onKeyUp.add(g),i.onSetContent.add(g),i.onVisualAid.add(g),i.onPreProcess.add(function(e,t){var n=t.node.lastChild;n&&n.childNodes.length==1&&n.firstChild.nodeName=="BR"&&e.dom.remove(n)}),e.isGecko&&i.onKeyDown.add(function(t,n){var r,i,s;n.keyCode===e.VK.ENTER&&n.shiftKey&&(r=t.selection.getRng().startContainer,i=p.getParent(r,"td,th"),i&&(s=t.getDoc().createTextNode("﻿"),p.insertAfter(s,r)))}),g(),i.startContent=i.getContent({format:"raw"})}}),t({mceTableSplitCells:function(e){e.split()},mceTableMergeCells:function(e){var t,n,r=i.dom.getParent(i.selection.getNode(),"th,td");r&&(t=r.rowSpan,n=r.colSpan),i.dom.select("td.mceSelected,th.mceSelected").length?e.merge():u.open({url:o+"/merge_cells.htm",width:240+parseInt(i.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(i.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:t,cols:n,onaction:function(t){e.merge(r,t.cols,t.rows)},plugin_url:o})},mceTableInsertRowBefore:function(e){e.insertRow(!0)},mceTableInsertRowAfter:function(e){e.insertRow()},mceTableInsertColBefore:function(e){e.insertCol(!0)},mceTableInsertColAfter:function(e){e.insertCol()},mceTableDeleteCol:function(e){e.deleteCols()},mceTableDeleteRow:function(e){e.deleteRows()},mceTableCutRow:function(e){a=e.cutRows()},mceTableCopyRow:function(e){a=e.copyRows()},mceTablePasteRowBefore:function(e){e.pasteRows(a,!0)},mceTablePasteRowAfter:function(e){e.pasteRows(a)},mceTableDelete:function(e){e.deleteTable()}},function(e,t){i.addCommand(t,function(){var t=l();t&&(e(t),i.execCommand("mceRepaint"),c())})}),t({mceInsertTable:function(e){u.open({url:o+"/table.htm",width:400+parseInt(i.getLang("table.table_delta_width",0)),height:320+parseInt(i.getLang("table.table_delta_height",0)),inline:1},{plugin_url:o,action:e?e.action:0})},mceTableRowProps:function(){u.open({url:o+"/row.htm",width:400+parseInt(i.getLang("table.rowprops_delta_width",0)),height:295+parseInt(i.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:o})},mceTableCellProps:function(){u.open({url:o+"/cell.htm",width:400+parseInt(i.getLang("table.cellprops_delta_width",0)),height:295+parseInt(i.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:o})}},function(e,t){i.addCommand(t,function(t,n){e(n)})})}}),e.PluginManager.add("table",e.plugins.TablePlugin)})(tinymce);