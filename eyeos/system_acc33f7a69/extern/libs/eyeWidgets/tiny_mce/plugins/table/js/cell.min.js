function init(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;ed=tinyMCEPopup.editor,tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),e=ed,t=ed.dom.getParent(ed.selection.getStart(),"td,th"),n=document.forms[0],r=ed.dom.parseStyle(ed.dom.getAttrib(t,"style")),i=t.nodeName.toLowerCase(),s=ed.dom.getAttrib(t,"align"),o=ed.dom.getAttrib(t,"valign"),u=trimSize(getStyle(t,"width","width")),a=trimSize(getStyle(t,"height","height")),f=convertRGBToHex(getStyle(t,"bordercolor","borderLeftColor")),l=convertRGBToHex(getStyle(t,"bgcolor","backgroundColor")),c=ed.dom.getAttrib(t,"class"),h=getStyle(t,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),p=ed.dom.getAttrib(t,"id"),d=ed.dom.getAttrib(t,"lang"),v=ed.dom.getAttrib(t,"dir"),m=ed.dom.getAttrib(t,"scope"),addClassesToList("class","table_cell_styles"),TinyMCE_EditableSelects.init(),ed.dom.hasClass(t,"mceSelected")?tinyMCEPopup.dom.hide("action"):(n.bordercolor.value=f,n.bgcolor.value=l,n.backgroundimage.value=h,n.width.value=u,n.height.value=a,n.id.value=p,n.lang.value=d,n.style.value=ed.dom.serializeStyle(r),selectByValue(n,"align",s),selectByValue(n,"valign",o),selectByValue(n,"class",c,!0,!0),selectByValue(n,"celltype",i),selectByValue(n,"dir",v),selectByValue(n,"scope",m),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"))}function updateAction(){var e,t,n,r,i,s,o,u,a,f,l,c=ed,h=document.forms[0];if(!AutoValidator.validate(h))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(h).join(". ")+"."),!1;tinyMCEPopup.restoreSelection(),e=ed.selection.getStart(),t=ed.dom.getParent(e,"td,th"),n=ed.dom.getParent(e,"tr"),r=ed.dom.getParent(e,"table");if(ed.dom.hasClass(t,"mceSelected")){tinymce.each(ed.dom.select("td.mceSelected,th.mceSelected"),function(e){updateCell(e)}),ed.addVisual(),ed.nodeChanged(),c.execCommand("mceEndUndoLevel"),tinyMCEPopup.close();return}switch(getSelectValue(h,"action")){case"cell":i=getSelectValue(h,"celltype"),s=getSelectValue(h,"scope");function p(e){e&&(updateCell(t),ed.addVisual(),ed.nodeChanged(),c.execCommand("mceEndUndoLevel"),tinyMCEPopup.close())}if(ed.getParam("accessibility_warnings",1)){i=="th"&&s==""?tinyMCEPopup.confirm(ed.getLang("table_dlg.missing_scope","",!0),p):p(1);return}updateCell(t);break;case"row":o=n.firstChild,o.nodeName!="TD"&&o.nodeName!="TH"&&(o=nextCell(o));do o=updateCell(o,!0);while((o=nextCell(o))!=null);break;case"col":a=0,o=n.firstChild,f=r.getElementsByTagName("tr"),o.nodeName!="TD"&&o.nodeName!="TH"&&(o=nextCell(o));do{if(o==t)break;a+=o.getAttribute("colspan")}while((o=nextCell(o))!=null);for(l=0;l<f.length;l++){o=f[l].firstChild,o.nodeName!="TD"&&o.nodeName!="TH"&&(o=nextCell(o)),u=0;do{if(u==a){o=updateCell(o,!0);break}u+=o.getAttribute("colspan")}while((o=nextCell(o))!=null)}break;case"all":f=r.getElementsByTagName("tr");for(l=0;l<f.length;l++){o=f[l].firstChild,o.nodeName!="TD"&&o.nodeName!="TH"&&(o=nextCell(o));do o=updateCell(o,!0);while((o=nextCell(o))!=null)}}ed.addVisual(),ed.nodeChanged(),c.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function nextCell(e){while((e=e.nextSibling)!=null)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function updateCell(e,t){var n,r,i,s=ed,o=document.forms[0],u=e.nodeName.toLowerCase(),a=getSelectValue(o,"celltype"),f=s.getDoc(),l=ed.dom;t||l.setAttrib(e,"id",o.id.value),l.setAttrib(e,"align",o.align.value),l.setAttrib(e,"vAlign",o.valign.value),l.setAttrib(e,"lang",o.lang.value),l.setAttrib(e,"dir",getSelectValue(o,"dir")),l.setAttrib(e,"style",ed.dom.serializeStyle(ed.dom.parseStyle(o.style.value))),l.setAttrib(e,"scope",o.scope.value),l.setAttrib(e,"class",getSelectValue(o,"class")),ed.dom.setAttrib(e,"width",""),ed.dom.setAttrib(e,"height",""),ed.dom.setAttrib(e,"bgColor",""),ed.dom.setAttrib(e,"borderColor",""),ed.dom.setAttrib(e,"background",""),e.style.width=getCSSSize(o.width.value),e.style.height=getCSSSize(o.height.value),o.bordercolor.value!=""?(e.style.borderColor=o.bordercolor.value,e.style.borderStyle=e.style.borderStyle==""?"solid":e.style.borderStyle,e.style.borderWidth=e.style.borderWidth==""?"1px":e.style.borderWidth):e.style.borderColor="",e.style.backgroundColor=o.bgcolor.value,o.backgroundimage.value!=""?e.style.backgroundImage="url('"+o.backgroundimage.value+"')":e.style.backgroundImage="";if(u!=a){n=f.createElement(a);for(r=0;r<e.childNodes.length;r++)n.appendChild(e.childNodes[r].cloneNode(1));for(i=0;i<e.attributes.length;i++)ed.dom.setAttrib(n,e.attributes[i].name,ed.dom.getAttrib(e,e.attributes[i].name));e.parentNode.replaceChild(n,e),e=n}return l.setAttrib(e,"style",l.serializeStyle(l.parseStyle(e.style.cssText))),e}function changedBackgroundImage(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=ed.dom.serializeStyle(t)}function changedSize(){var e,t=document.forms[0],n=ed.dom.parseStyle(t.style.value),r=t.width.value;r!=""?n.width=getCSSSize(r):n.width="",e=t.height.value,e!=""?n.height=getCSSSize(e):n.height="",t.style.value=ed.dom.serializeStyle(n)}function changedColor(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,t["border-color"]=e.bordercolor.value,e.style.value=ed.dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]?e.backgroundimage.value=t["background-image"].replace(RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):e.backgroundimage.value="",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}var ed;tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(init);