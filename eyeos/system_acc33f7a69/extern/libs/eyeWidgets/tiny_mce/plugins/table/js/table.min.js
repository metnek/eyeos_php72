function insertTable(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=document.forms[0],m=tinyMCEPopup.editor,g=m.dom,y=2,b=2,w=0,E=-1,S=-1,x="";tinyMCEPopup.restoreSelection();if(!AutoValidator.validate(v))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(v).join(". ")+"."),!1;a=g.getParent(m.selection.getNode(),"table"),y=v.elements.cols.value,b=v.elements.rows.value,w=v.elements["border"].value!=""?v.elements.border.value:0,E=v.elements["cellpadding"].value!=""?v.elements.cellpadding.value:"",S=v.elements["cellspacing"].value!=""?v.elements.cellspacing.value:"",e=getSelectValue(v,"align"),s=getSelectValue(v,"tframe"),o=getSelectValue(v,"rules"),t=v.elements.width.value,n=v.elements.height.value,bordercolor=v.elements.bordercolor.value,bgcolor=v.elements.bgcolor.value,r=getSelectValue(v,"class"),id=v.elements.id.value,summary=v.elements.summary.value,style=v.elements.style.value,dir=v.elements.dir.value,lang=v.elements.lang.value,background=v.elements.backgroundimage.value,i=v.elements.caption.checked,f=tinyMCEPopup.getParam("table_cell_limit",!1),l=tinyMCEPopup.getParam("table_row_limit",!1),c=tinyMCEPopup.getParam("table_col_limit",!1);if(c&&y>c)return tinyMCEPopup.alert(m.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,c)),!1;if(l&&b>l)return tinyMCEPopup.alert(m.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,l)),!1;if(f&&y*b>f)return tinyMCEPopup.alert(m.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,f)),!1;if(action=="update")return g.setAttrib(a,"cellPadding",E,!0),g.setAttrib(a,"cellSpacing",S,!0),isCssSize(w)?g.setAttrib(a,"border",""):g.setAttrib(a,"border",w),w==""&&(g.setStyle(a,"border-width",""),g.setStyle(a,"border",""),g.setAttrib(a,"border","")),g.setAttrib(a,"align",e),g.setAttrib(a,"frame",s),g.setAttrib(a,"rules",o),g.setAttrib(a,"class",r),g.setAttrib(a,"style",style),g.setAttrib(a,"id",id),g.setAttrib(a,"summary",summary),g.setAttrib(a,"dir",dir),g.setAttrib(a,"lang",lang),u=m.dom.select("caption",a)[0],u&&!i&&u.parentNode.removeChild(u),!u&&i&&(u=a.ownerDocument.createElement("caption"),tinymce.isIE||(u.innerHTML='<br data-mce-bogus="1"/>'),a.insertBefore(u,a.firstChild)),t&&m.settings.inline_styles?(g.setStyle(a,"width",t),g.setAttrib(a,"width","")):(g.setAttrib(a,"width",t,!0),g.setStyle(a,"width","")),g.setAttrib(a,"borderColor",""),g.setAttrib(a,"bgColor",""),g.setAttrib(a,"background",""),n&&m.settings.inline_styles?(g.setStyle(a,"height",n),g.setAttrib(a,"height","")):(g.setAttrib(a,"height",n,!0),g.setStyle(a,"height","")),background!=""?a.style.backgroundImage="url('"+background+"')":a.style.backgroundImage="",bordercolor!=""?(a.style.borderColor=bordercolor,a.style.borderStyle=a.style.borderStyle==""?"solid":a.style.borderStyle,a.style.borderWidth=cssSize(w)):a.style.borderColor="",a.style.backgroundColor=bgcolor,a.style.height=getCSSSize(n),m.addVisual(),m.nodeChanged(),m.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),(v.width.value!=orgTableWidth||v.height.value!=orgTableHeight)&&m.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;x+="<table",x+=makeAttrib("id",id),isCssSize(w)||(x+=makeAttrib("border",w)),x+=makeAttrib("cellpadding",E),x+=makeAttrib("cellspacing",S),x+=makeAttrib("data-mce-new","1"),t&&m.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(t)&&(t+="px"),style+="width: "+t):x+=makeAttrib("width",t),x+=makeAttrib("align",e),x+=makeAttrib("frame",s),x+=makeAttrib("rules",o),x+=makeAttrib("class",r),x+=makeAttrib("style",style),x+=makeAttrib("summary",summary),x+=makeAttrib("dir",dir),x+=makeAttrib("lang",lang),x+=">",i&&(tinymce.isIE?x+="<caption></caption>":x+='<caption><br data-mce-bogus="1"/></caption>');for(h=0;h<b;h++){x+="<tr>";for(p=0;p<y;p++)tinymce.isIE?x+="<td></td>":x+='<td><br data-mce-bogus="1"/></td>';x+="</tr>"}x+="</table>",m.settings.fix_table_elements?(d="",m.focus(),m.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(e){d&&(d+=","),d+=e+" ._mce_marker"}),tinymce.each(m.dom.select(d),function(e){m.dom.split(m.dom.getParent(e,"h1,h2,h3,h4,h5,h6,p"),e)}),g.setOuterHTML(g.select("br._mce_marker")[0],x)):m.execCommand("mceInsertContent",!1,x),tinymce.each(g.select("table[data-mce-new]"),function(e){var t;tinymce.isIE&&e.nextSibling==null&&g.insertAfter(g.create("p"),e),t=g.select("td,th",e);try{m.selection.setCursorLocation(t[0],0)}catch(n){}g.setAttrib(e,"data-mce-new","")}),m.addVisual(),m.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),tinyMCEPopup.close()}function makeAttrib(e,t){var n=document.forms[0],r=n.elements[e];if(typeof t=="undefined"||t==null)t="",r&&(t=r.value);return t==""?"":(t=t.replace(/&/g,"&amp;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")," "+e+'="'+t+'"')}function init(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),e=2,t=2,n=tinyMCEPopup.getParam("table_default_border","0"),r=tinyMCEPopup.getParam("table_default_cellpadding",""),i=tinyMCEPopup.getParam("table_default_cellspacing",""),s="",o="",u="",a="",f="",l="",c="",h="",p="",d="",v="",m="",f="",a="",g="",y="",b=tinyMCEPopup.editor,w=b.dom,E=document.forms[0],S=w.getParent(b.selection.getNode(),"table"),action=tinyMCEPopup.getWindowArg("action"),action||(action=S?"update":"insert");if(S&&action!="insert"){x=S.rows,e=0;for(T=0;T<x.length;T++)x[T].cells.length>e&&(e=x[T].cells.length);e=e,t=x.length,st=w.parseStyle(w.getAttrib(S,"style")),n=trimSize(getStyle(S,"border","borderWidth")),r=w.getAttrib(S,"cellpadding",""),i=w.getAttrib(S,"cellspacing",""),o=trimSize(getStyle(S,"width","width")),u=trimSize(getStyle(S,"height","height")),a=convertRGBToHex(getStyle(S,"bordercolor","borderLeftColor")),f=convertRGBToHex(getStyle(S,"bgcolor","backgroundColor")),s=w.getAttrib(S,"align",s),y=w.getAttrib(S,"frame"),g=w.getAttrib(S,"rules"),l=tinymce.trim(w.getAttrib(S,"class").replace(/mceItem.+/g,"")),c=w.getAttrib(S,"id"),h=w.getAttrib(S,"summary"),p=w.serializeStyle(st),d=w.getAttrib(S,"dir"),v=w.getAttrib(S,"lang"),m=getStyle(S,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),E.caption.checked=S.getElementsByTagName("caption").length>0,orgTableWidth=o,orgTableHeight=u,action="update",E.insert.value=b.getLang("update")}addClassesToList("class","table_styles"),TinyMCE_EditableSelects.init(),selectByValue(E,"align",s),selectByValue(E,"tframe",y),selectByValue(E,"rules",g),selectByValue(E,"class",l,!0,!0),E.cols.value=e,E.rows.value=t,E.border.value=n,E.cellpadding.value=r,E.cellspacing.value=i,E.width.value=o,E.height.value=u,E.bordercolor.value=a,E.bgcolor.value=f,E.id.value=c,E.summary.value=h,E.style.value=p,E.dir.value=d,E.lang.value=v,E.backgroundimage.value=m,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),action=="update"&&(E.cols.disabled=!0,E.rows.disabled=!0)}function changedSize(){var e=document.forms[0],t=dom.parseStyle(e.style.value),n=e.height.value;n!=""?t.height=getCSSSize(n):t.height="",e.style.value=dom.serializeStyle(t)}function isCssSize(e){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(e)}function cssSize(e,t){return e=tinymce.trim(e||t),isCssSize(e)?e:parseInt(e,10)+"px"}function changedBackgroundImage(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=dom.serializeStyle(t)}function changedBorder(){var e=document.forms[0],t=dom.parseStyle(e.style.value);e.border.value==""||!isCssSize(e.border.value)&&e.bordercolor.value==""?e.border.value||(t.border="",t["border-width"]=""):t["border-width"]=cssSize(e.border.value),e.style.value=dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,e.bordercolor.value!=""&&(t["border-color"]=e.bordercolor.value,t["border-width"]||(t["border-width"]=cssSize(e.border.value,1))),e.style.value=dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-image"]?e.backgroundimage.value=t["background-image"].replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):e.backgroundimage.value="",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}var action,orgTableWidth,orgTableHeight,dom;tinyMCEPopup.requireLangPack(),dom=tinyMCEPopup.editor.dom,tinyMCEPopup.onInit.add(init);