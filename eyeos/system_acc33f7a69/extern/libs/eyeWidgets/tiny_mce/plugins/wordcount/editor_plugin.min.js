(function(){tinymce.create("tinymce.plugins.WordCount",{block:0,id:null,countre:null,cleanre:null,init:function(e){function i(e){return e!==n&&(e===r.ENTER||n===r.SPACEBAR||s(n))}function s(e){return e===r.DELETE||e===r.BACKSPACE}var t=this,n=0,r=tinymce.VK;t.countre=e.getParam("wordcount_countregex",/[\w\u2019\'-]+/g),t.cleanre=e.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\'\"_+=\\\/-]*/g),t.update_rate=e.getParam("wordcount_update_rate",2e3),t.update_on_delete=e.getParam("wordcount_update_on_delete",!1),t.id=e.id+"-word-count",e.onPostRender.add(function(e){var n,r=e.getParam("wordcount_target_id");r?tinymce.DOM.add(r,"span",{},'<span id="'+t.id+'">0</span>'):(n=tinymce.DOM.get(e.id+"_path_row"),n&&tinymce.DOM.add(n.parentNode,"div",{style:"float: right"},e.getLang("wordcount.words","Words: ")+'<span id="'+t.id+'">0</span>'))}),e.onInit.add(function(e){e.selection.onSetContent.add(function(){t._count(e)}),t._count(e)}),e.onSetContent.add(function(e){t._count(e)}),e.onKeyUp.add(function(e,r){(i(r.keyCode)||t.update_on_delete&&s(r.keyCode))&&t._count(e),n=r.keyCode})},_getCount:function(e){var t,n=0,r=e.getContent({format:"raw"});return r&&(r=r.replace(/\.\.\./g," "),r=r.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),r=r.replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," "),r=r.replace(this.cleanre,""),t=r.match(this.countre),t&&(n=t.length)),n},_count:function(e){var t=this;if(t.block)return;t.block=1,setTimeout(function(){var n;e.destroyed||(n=t._getCount(e),tinymce.DOM.setHTML(t.id,n+""),setTimeout(function(){t.block=0},t.update_rate))},1)},getInfo:function(){return{longname:"Word Count plugin",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/wordcount",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("wordcount",tinymce.plugins.WordCount)})();