(function(){var e=tinymce.dom.Event,t=tinymce.each,n=tinymce.DOM;tinymce.create("tinymce.plugins.ContextMenu",{init:function(t){function o(t,n){i=0;if(n&&n.button==2){i=n.ctrlKey;return}s._menu&&(s._menu.removeAll(),s._menu.destroy(),e.remove(t.getDoc(),"click",o),s._menu=null)}var n,r,i,s=this;s.editor=t,r=t.settings.contextmenu_never_use_native,s.onContextMenu=new tinymce.util.Dispatcher(this),n=t.onContextMenu.add(function(t,n){if((i!==0?i:n.ctrlKey)&&!r)return;e.cancel(n),n.target.nodeName=="IMG"&&t.selection.select(n.target),s._getMenu(t).showMenu(n.clientX||n.pageX,n.clientY||n.pageY),e.add(t.getDoc(),"click",function(e){o(t,e)}),t.nodeChanged()}),t.onRemove.add(function(){s._menu&&s._menu.removeAll()}),t.onMouseDown.add(o),t.onKeyDown.add(o),t.onKeyDown.add(function(t,r){r.shiftKey&&!r.ctrlKey&&!r.altKey&&r.keyCode===121&&(e.cancel(r),n(t,r))})},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(e){var t,r,i=this,s=i._menu,o=e.selection,u=o.isCollapsed(),a=o.getNode()||e.getBody();s&&(s.removeAll(),s.destroy()),r=n.getPos(e.getContentAreaContainer()),s=e.controlManager.createDropMenu("contextmenu",{offset_x:r.x+e.getParam("contextmenu_offset_x",0),offset_y:r.y+e.getParam("contextmenu_offset_y",0),constrain:1,keyboard_focus:!0}),i._menu=s,s.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(u),s.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(u),s.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"});if(a.nodeName=="A"&&!e.dom.getAttrib(a,"name")||!u)s.addSeparator(),s.add({title:"advanced.link_desc",icon:"link",cmd:e.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),s.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});return s.addSeparator(),s.add({title:"advanced.image_desc",icon:"image",cmd:e.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),s.addSeparator(),t=s.addMenu({title:"contextmenu.align"}),t.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"}),t.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"}),t.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"}),t.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"}),i.onContextMenu.dispatch(i,s,a,u),s}}),tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu)})();