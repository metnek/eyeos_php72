(function(){function r(e,t){while(e&&(e.nodeType===8||e.nodeType===3&&/^[ \t\n\r]*$/.test(e.nodeValue)))e=t(e);return e}function i(e){return r(e,function(e){return e.previousSibling})}function s(e){return r(e,function(e){return e.nextSibling})}function o(e,t,n){return e.dom.getParent(t,function(e){return tinymce.inArray(n,e)!==-1})}function u(e){return e&&(e.tagName==="OL"||e.tagName==="UL")}function a(e,t){var n,r,s=i(e.lastChild);while(u(s))n=s,s=i(n.previousSibling);return n&&(r=t.create("li",{style:"list-style-type: none;"}),t.split(e,n),t.insertAfter(r,n),r.appendChild(n),r.appendChild(n),e=r.previousSibling),e}function f(e,t,n){return e=l(e,t,n),c(e,t,n)}function l(e,t,n){var r=i(e.previousSibling);return r?h(r,e,t?r:!1,n):e}function c(e,t,n){var r=s(e.nextSibling);return r?h(e,r,t?r:!1,n):e}function h(e,t,n,r){return p(e,t,!!n,r)?m(e,t,n):(e&&e.tagName==="LI"&&u(t)&&e.appendChild(t),t)}function p(e,t,n,r){return!e||!t?!1:e.tagName==="LI"&&t.tagName==="LI"?t.style.listStyleType==="none"||v(t):u(e)?e.tagName===t.tagName&&(n||e.style.listStyleType===t.style.listStyleType)||d(t):r&&e.tagName==="P"&&t.tagName==="P"}function d(e){var t=s(e.firstChild),n=i(e.lastChild);return t&&n&&u(e)&&t===n&&(u(t)||t.style.listStyleType==="none"||v(t))}function v(e){var t=s(e.firstChild),n=i(e.lastChild);return t&&n&&t===n&&u(t)}function m(e,t,n){var r=i(e.lastChild),o=s(t.firstChild);e.tagName==="P"&&e.appendChild(e.ownerDocument.createElement("br"));while(t.firstChild)e.appendChild(t.firstChild);return n&&(e.style.listStyleType=n.style.listStyleType),t.parentNode.removeChild(t),h(r,o,!1),e}function g(e,t){var n;return t.is(e,"li,ol,ul")||(n=t.getParent(e,"li"),n&&(e=n)),e}var e,t=tinymce.each,n=tinymce.dom.Event;tinymce.create("tinymce.plugins.Lists",{init:function(e){function f(t){return t.keyCode===tinymce.VK.TAB&&!t.altKey&&!t.ctrlKey&&(e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList"))}function l(){var e=p(),t=e.parentNode.parentNode,n=e.parentNode.lastChild===e;return n&&!c(t)&&d(e)}function c(e){return u(e)?e.parentNode&&e.parentNode.tagName==="LI":e.tagName==="LI"}function h(){return e.selection.isCollapsed()&&d(p())}function p(){var t=e.selection.getStart();return t.tagName!="BR"&&t.tagName!=""||t.parentNode.tagName!="LI"?t:t.parentNode}function d(e){var t=e.childNodes.length;return e.tagName==="LI"?t==0?!0:t==1&&(e.firstChild.tagName==""||e.firstChild.tagName=="BR"||v(e)):!1}function v(e){var t=tinymce.grep(e.parentNode.childNodes,function(e){return e.tagName=="LI"}),n=e==t[t.length-1],r=e.firstChild;return tinymce.isIE9&&n&&(r.nodeValue==String.fromCharCode(160)||r.nodeValue==String.fromCharCode(32))}function m(e){return e.keyCode===tinymce.VK.ENTER}function g(e){return m(e)&&!e.shiftKey}function y(e){return f(e)?t:g(e)&&l()?i:g(e)&&h()?r:o}function b(e,s){(a==t||a==r||tinymce.isGecko&&a==i)&&n.cancel(s)}function w(){var t,n=e.selection.getRng(!0),r=n.startContainer;return r.nodeType==3?(t=r.nodeValue,tinymce.isIE9&&t.length>1&&t.charCodeAt(t.length-1)==32?n.endOffset==t.length-1:n.endOffset==t.length):r.nodeType==1?n.endOffset==r.childNodes.length:!1}function E(){var t=e.selection.getNode(),n="h1,h2,h3,h4,h5,h6,p,div",r=e.dom.is(t,n)&&t.parentNode.tagName==="LI"&&t.parentNode.lastChild===t;return e.selection.isCollapsed()&&r&&w()}function S(e,t){var n,r,i;g(t)&&E()&&(n=e.selection.getNode(),r=e.dom.create("li"),i=e.dom.getParent(n,"li"),e.dom.insertAfter(r,i),tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8?(r.appendChild(e.dom.create("&nbsp;")),e.selection.setCursorLocation(r,1)):tinyMCE.isGecko?setTimeout(function(){var t=e.getDoc().createTextNode("﻿");r.appendChild(t),e.selection.setCursorLocation(r,0)},0):e.selection.setCursorLocation(r,0),t.preventDefault())}function x(e,t){function f(e){var t=e.firstChild,n=null;do{if(!t)break;t.tagName==="LI"&&(n=t)}while(t=t.nextSibling);return n}function l(e,t){while(e.childNodes.length>0)t.appendChild(e.childNodes[0])}var n,r,i,s,o,u,a;if(!tinymce.isGecko)return;r=e.selection.getStart();if(t.keyCode!=tinymce.VK.BACKSPACE||r.tagName!=="IMG")return;n=r.parentNode.previousSibling;if(!n)return;if(n.tagName==="UL"||n.tagName==="OL")i=n;else{if(!n.previousSibling||n.previousSibling.tagName!=="UL"&&n.previousSibling.tagName!=="OL")return;i=n.previousSibling}s=f(i),o=e.dom.createRng(),o.setStart(s,1),o.setEnd(s,1),e.selection.setRng(o),e.selection.collapse(!0),u=e.selection.getBookmark(),a=r.parentNode.cloneNode(!0),a.tagName==="P"||a.tagName==="DIV"?l(a,s):s.appendChild(a),r.parentNode.parentNode.removeChild(r.parentNode),e.selection.moveToBookmark(u)}function T(t){var n,r=e.dom.getParent(t,"ol,ul");r!=null&&(n=r.lastChild,n.appendChild(e.getDoc().createElement("")),e.selection.setCursorLocation(n,0))}function N(t,n){var r=e.getDoc().createTextNode("﻿");t.insertBefore(r,n),e.selection.setCursorLocation(r,0),e.execCommand("mceRepaint")}function C(e,t){var n,r,i;m(t)&&(n=p(),n&&(r=n.parentNode,i=r&&r.parentNode,i&&i.nodeName=="LI"&&i.firstChild==r&&n==r.firstChild&&N(i,r)))}function k(e,t){var n,r;m(t)&&(n=p(),e.dom.select("ul li",n).length===1&&(r=n.firstChild,N(n,r)))}function L(e,t){function o(t,n){var r,i=[],s=new tinymce.dom.TreeWalker(n,t);for(r=s.current();r;r=s.next())e.dom.is(r,"ol,ul,li")&&i.push(r);return i}var r,i,s;if(t.keyCode==tinymce.VK.BACKSPACE){r=p();if(r){i=e.dom.getParent(r,"ol,ul");if(i&&i.firstChild===r)return s=o(i,r),e.execCommand("Outdent",!1,s),e.undoManager.add(),n.cancel(t)}}}function A(e,t){var r,i,s,o=p();if(t.keyCode===tinymce.VK.BACKSPACE&&e.dom.is(o,"li")&&o.parentNode.firstChild!==o&&e.dom.select("ul,ol",o).length===1)return r=o.previousSibling,e.dom.remove(e.dom.select("br",o)),e.dom.remove(o,!0),i=tinymce.grep(r.childNodes,function(e){return e.nodeType===3}),i.length===1&&(s=i[0],e.selection.setCursorLocation(s,s.length)),e.undoManager.add(),n.cancel(t)}var t="TABBING",r="EMPTY",i="ESCAPE",s="PARAGRAPH",o="UNKNOWN",a=o;this.ed=e,e.addCommand("Indent",this.indent,this),e.addCommand("Outdent",this.outdent,this),e.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),e.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),e.onInit.add(function(){e.editorCommands.addCommands({outdent:function(){function r(t){return t=n.getParent(t,n.isBlock),t&&parseInt(e.dom.getStyle(t,"margin-left")||0,10)+parseInt(e.dom.getStyle(t,"padding-left")||0,10)>0}var t=e.selection,n=e.dom;return r(t.getStart())||r(t.getEnd())||e.queryCommandState("InsertOrderedList")||e.queryCommandState("InsertUnorderedList")}},"state")}),e.onKeyUp.add(function(e,s){var u,f,l;if(a==t)return e.execCommand(s.shiftKey?"Outdent":"Indent",!0,null),a=o,n.cancel(s);if(a==r)return u=p(),f=e.settings.list_outdent_on_enter===!0||s.shiftKey,e.execCommand(f?"Outdent":"Indent",!0,null),tinymce.isIE&&T(u),n.cancel(s);if(a==i)if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8)l=e.getDoc().createTextNode("﻿"),e.selection.getNode().appendChild(l);else if(tinymce.isIE9||tinymce.isGecko)return e.execCommand("Outdent"),n.cancel(s)}),e.onKeyDown.add(function(e,t){a=y(t)}),e.onKeyDown.add(b),e.onKeyDown.add(x),e.onKeyDown.add(S),tinymce.isGecko&&e.onKeyUp.add(C),tinymce.isIE8&&e.onKeyUp.add(k),(tinymce.isGecko||tinymce.isWebKit)&&e.onKeyDown.add(L),tinymce.isWebKit&&e.onKeyDown.add(A)},applyList:function(n,r){function m(e){e&&e.tagName==="BR"&&u.remove(e)}function y(e){function i(e){(e.style.marginLeft||e.style.paddingLeft)&&s.adjustPaddingFunction(!1)(e)}var t,r=u.create(n);if(e.tagName!=="LI"){if(e.tagName==="P"||e.tagName==="DIV"||e.tagName==="BODY"){w(e,function(n,r){b(n,r,e.tagName==="BODY"?null:n.parentNode),t=n.parentNode,i(t),m(r)}),t&&(t.tagName==="LI"&&(e.tagName==="P"||v.length>1)&&u.split(t.parentNode.parentNode,t.parentNode),f(t.parentNode,!0));return}t=u.create("li"),u.insertAfter(t,e),t.appendChild(e),i(e),e=t}u.insertAfter(r,e),r.appendChild(e),f(r,!0),l.push(e)}function b(e,t,n){var r,i,s=e;while(!u.isBlock(e.parentNode)&&e.parentNode!==u.getRoot())e=u.split(e.parentNode,e.previousSibling),e=e.nextSibling,s=e;if(n){r=n.cloneNode(!0),e.parentNode.insertBefore(r,e);while(r.firstChild)u.remove(r.firstChild);r=u.rename(r,"li")}else r=u.create("li"),e.parentNode.insertBefore(r,e);while(s&&s!=t)i=s.nextSibling,r.appendChild(s),s=i;r.childNodes.length===0&&(r.innerHTML='<br _mce_bogus="1" />'),y(r)}function w(n,r){function h(t,n){var r,i=u.createRng();return e.keep=!0,o.selection.moveToBookmark(e),e.keep=!1,r=o.selection.getRng(!0),n||(n=t.parentNode.lastChild),i.setStartBefore(t),i.setEndAfter(n),i.compareBoundaryPoints(f,r)<=0&&i.compareBoundaryPoints(l,r)>0}function p(e){if(e.nextSibling)return e.nextSibling;if(!u.isBlock(e.parentNode)&&e.parentNode!==u.getRoot())return p(e.parentNode)}var i,s,a,f=3,l=1,c="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";i=n.firstChild,a=!1,t(u.select(c,n),function(e){if(e.hasAttribute&&e.hasAttribute("_mce_bogus"))return!0;h(i,e)&&(u.addClass(e,"_mce_tagged_br"),i=p(e))}),a=i&&h(i,undefined),i=n.firstChild,t(u.select(c,n),function(e){var t=p(e);if(e.hasAttribute&&e.hasAttribute("_mce_bogus"))return!0;u.hasClass(e,"_mce_tagged_br")?(r(i,e,s),s=null):s=e,i=t}),a&&r(i,undefined,s)}function E(e){w(e,function(e,t,n){b(e,t),m(t),m(n)})}function S(e){if(tinymce.inArray(l,e)!==-1)return;e.parentNode.tagName===r&&(u.split(e.parentNode,e),y(e),c(e.parentNode,!1)),l.push(e)}function x(e){var t,n,r,i;if(tinymce.inArray(l,e)!==-1)return;e=a(e,u);while(u.is(e.parentNode,"ol,ul,li"))u.split(e.parentNode,e);l.push(e),e=u.rename(e,"p"),r=f(e,!1,o.settings.force_br_newlines);if(r===e){t=e.firstChild;while(t)u.isBlock(t)?(t=u.split(t.parentNode,t),i=!0,n=t.nextSibling&&t.nextSibling.firstChild):(n=t.nextSibling,i&&t.tagName==="BR"&&u.remove(t),i=!1),t=n}}var i,s=this,o=s.ed,u=o.dom,l=[],h=!1,p=!1,d=!1,v=o.selection.getSelectedBlocks();t(v,function(e){e=g(e,u),e.tagName===r||e.tagName==="LI"&&e.parentNode.tagName===r?p=!0:e.tagName===n||e.tagName==="LI"&&e.parentNode.tagName===n?h=!0:d=!0}),d&&!h||p||v.length===0?i={LI:S,H1:y,H2:y,H3:y,H4:y,H5:y,H6:y,P:y,BODY:y,DIV:v.length>1?y:E,defaultAction:E,elements:this.selectedBlocks()}:i={defaultAction:x,elements:this.selectedBlocks()},this.process(i)},indent:function(){function r(e){var n=t.create("li",{style:"list-style-type: none;"});return t.insertAfter(n,e),n}function i(e){var n,i=r(e),s=t.getParent(e,"ol,ul"),o=s.tagName,u=t.getStyle(s,"list-style-type"),a={};return u!==""&&(a.style="list-style-type: "+u+";"),n=t.create(o,a),i.appendChild(n),n}function s(r){var s;o(e,r,n)||(r=a(r,t),s=i(r),s.appendChild(r),f(s.parentNode,!1),f(s,!1),n.push(r))}var e=this.ed,t=e.dom,n=[];this.process({LI:s,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(e,n){function c(e){var t,n,r;if(!o(s,e,l)){if(u.getStyle(e,"margin-left")!==""||u.getStyle(e,"padding-left")!=="")return i.adjustPaddingFunction(!1)(e);r=u.getStyle(e,"text-align",!0);if(r==="center"||r==="right"){u.setStyle(e,"text-align","left");return}e=a(e,u),t=e.parentNode,n=e.parentNode.parentNode,n.tagName==="P"?u.split(n,e.parentNode):(u.split(t,e),n.tagName==="LI"?u.split(n,e):u.is(n,"ol,ul")||u.rename(e,"p")),l.push(e)}}var r,i=this,s=i.ed,u=s.dom,l=[];r=n&&tinymce.is(n,"array")?n:this.selectedBlocks(),this.process({LI:c,defaultAction:this.adjustPaddingFunction(!1),elements:r}),t(l,f)},process:function(t){function f(e){var t=tinymce.grep(e.childNodes,function(e){return e.nodeName!=="BR"&&(e.nodeName!=="SPAN"||a.getAttrib(e,"data-mce-type")!="bookmark")&&(e.nodeType!=3||e.nodeValue!=String.fromCharCode(160)&&e.nodeValue!="")});return t.length===0}function l(e){var r;a.removeClass(e,"_mce_act_on");if(!e||e.nodeType!==1||n.length>1&&f(e))return;e=g(e,a),r=t[e.tagName],r||(r=t.defaultAction),r(e)}function c(e){o.splitSafeEach(e.childNodes,l)}function h(e,t){return t>=0&&e.hasChildNodes()&&t<e.childNodes.length&&e.childNodes[t].tagName==="BR"}function p(){var e=u.getNode(),t=a.getParent(e,"td");return t!==null}var n,r,i,s,o=this,u=o.ed.selection,a=o.ed.dom;n=t.elements,r=u.getRng(!0),r.collapsed||(h(r.endContainer,r.endOffset-1)&&(r.setEnd(r.endContainer,r.endOffset-1),u.setRng(r)),h(r.startContainer,r.startOffset)&&(r.setStart(r.startContainer,r.startOffset+1),u.setRng(r))),tinymce.isIE8&&(i=o.ed.selection.getNode(),i.tagName==="LI"&&i.parentNode.lastChild!==i&&(s=o.ed.getDoc().createTextNode("﻿"),i.appendChild(s))),e=u.getBookmark(),t.OL=t.UL=c,o.splitSafeEach(n,l),u.moveToBookmark(e),e=null,p()||o.ed.execCommand("mceRepaint")},splitSafeEach:function(e,n){tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(e,n):t(e,n)},classBasedEach:function(e,n){var r,i,s=this.ed.dom;t(e,function(e){s.addClass(e,"_mce_act_on")}),r=s.select("._mce_act_on");while(r.length>0)i=r.shift(),s.removeClass(i,"_mce_act_on"),n(i),r=s.select("._mce_act_on")},adjustPaddingFunction:function(e){var t=this.ed,n=t.settings.indentation,r=/[a-z%]+/i.exec(n);return n=parseInt(n,10),function(i){var s,o=parseInt(t.dom.getStyle(i,"margin-left")||0,10)+parseInt(t.dom.getStyle(i,"padding-left")||0,10);e?s=o+n:s=o-n,t.dom.setStyle(i,"padding-left",""),t.dom.setStyle(i,"margin-left",s>0?s+r:"")}},selectedBlocks:function(){var e=this.ed,t=e.selection.getSelectedBlocks();return t.length==0?[e.dom.getRoot()]:t},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)})();